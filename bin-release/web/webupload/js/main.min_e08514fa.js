function instanceOfIStageResizeable(e){return"resize"in e}var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{l(r.next(e))}catch(t){i(t)}}function s(e){try{l(r["throw"](e))}catch(t){i(t)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,i=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],i=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseEuiView=function(e){function t(t,n){var r=e.call(this)||this;return r._resources=null,r._btnEffect=null,r._controller=t,r._myParent=App.LayerManager.getLayerByType(n),r._isInit=!1,r.percentHeight=100,r.percentWidth=100,r}return __extends(t,e),Object.defineProperty(t.prototype,"myParent",{get:function(){return this._myParent},enumerable:!0,configurable:!0}),t.prototype.setResources=function(e){this._resources=e},t.prototype.isInit=function(){return this._isInit},t.prototype.registerFunc=function(e,t,n){this._controller.registerFunc(e,t,n)},t.prototype.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},t.prototype.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this._controller.applyControllerFunc.apply(this._controller,arguments)},t.prototype.isShow=function(){return null!=this.stage&&this.visible},t.prototype.addToParent=function(){this._myParent.addChild(this)},t.prototype.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},t.prototype.initUI=function(){this._isInit=!0},t.prototype.initData=function(){},t.prototype.setBtnEffect=function(e){var t=this;null==t._btnEffect&&(t._btnEffect=new UI.BtnEffectComponent(t,e))},t.prototype.addEvents=function(){},t.prototype.removeEvents=function(){},t.prototype.destroy=function(){this.removeEvents(),this._btnEffect&&this._btnEffect.dispose(),this._btnEffect=null,this._controller=null,this._myParent=null,this._resources=null},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.removeEvents(),this._btnEffect&&this._btnEffect.dispose(),this._btnEffect=null},t.prototype.loadResource=function(e,t){this._resources&&this._resources.length>0?(App.ResUtil.loadGroup(this._resources,e,this),this.once(eui.UIEvent.CREATION_COMPLETE,t,this)):(e(),t())},t.prototype.setVisible=function(e){this.visible=e},Object.defineProperty(t.prototype,"controller",{get:function(){return this._controller},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(BaseEuiView.prototype,"BaseEuiView",["IBaseView"]);var starlingswf;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getTextField=function(e){return this.getChildByName(e)},t.prototype.getMovie=function(e){return this.getChildByName(e)},t.prototype.getSprite=function(e){return this.getChildByName(e)},t.prototype.getImage=function(e){return this.getChildByName(e)},t}(egret.DisplayObjectContainer);e.SwfSprite=t,__reflect(t.prototype,"starlingswf.SwfSprite")}(starlingswf||(starlingswf={}));var BaseEuiItem=function(e){function t(t){var n=e.call(this)||this;n._btnEffect=null;var r=n;return r.skinName=t,r.addEventListener(egret.Event.REMOVED_FROM_STAGE,r.onRemoveFromStage,r,!1),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=this;App.LanguageManager.setModuleLanguage(t)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this)},t.prototype.onAwake=function(e){var t=this;t.data=e},t.prototype.setBtnEffect=function(e){var t=this;null==t._btnEffect&&(t._btnEffect=new UI.BtnEffectComponent(t,e))},t.prototype.removeEvents=function(){},t.prototype.onRemoveFromStage=function(e){var t=this;t.removeEvents(),this._btnEffect&&this._btnEffect.dispose(),this._btnEffect=null},t}(eui.ItemRenderer);__reflect(BaseEuiItem.prototype,"BaseEuiItem");var BaseController=function(){function e(){this._messages={}}return e.prototype.registerFunc=function(e,t,n){this._messages[e]=[t,n]},e.prototype.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this._messages[e];return r?r[0].apply(r[1],t):(Log.trace("消息"+e+"不存在侦听"),null)},e.prototype.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return App.ControllerManager.applyFunc.apply(App.ControllerManager,arguments)},e.prototype.setModel=function(e){this._model=e},e.prototype.getModel=function(){return this._model},e.prototype.getControllerModel=function(e){return App.ControllerManager.getControllerModel(e)},e}();__reflect(BaseController.prototype,"BaseController");var BaseModel=function(){function e(e){this._controller=e,this._controller.setModel(this)}return e}();__reflect(BaseModel.prototype,"BaseModel");var BaseProxy=function(){function e(e){this._controller=e}return e.prototype.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},e.prototype.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this._controller.applyControllerFunc.apply(this._controller,arguments)},e.prototype.receiveServerMsg=function(e,t,n){App.MessageCenter.addListener(e,t,n)},e.prototype.receiveServerMsgOnce=function(e,t,n){var r=function(o){this.removeServerMsg(e,r,this),t.apply(n,o)};this.receiveServerMsg(e,r,this)},e.prototype.receiveServerHttpUpdateMsg=function(e,t,n){this.receiveServerMsg(e+"_HttpUpdate",t,n)},e.prototype.receiveServerHttpUpdateMsgOnce=function(e,t,n){this.receiveServerMsgOnce(e+"_HttpUpdate",t,n)},e.prototype.removeServerMsg=function(e,t,n){App.MessageCenter.removeListener(e,t,n)},e.prototype.removeServerHttpUpdateMsg=function(e,t,n){this.removeServerMsg(e+"_HttpUpdate",t,n)},e.prototype.sendSocketMsg=function(e){},e.prototype.sendHttpMsg=function(e,t){void 0===t&&(t=null),App.Http.send(e,this.getURLVariables(e,t))},e.prototype.getURLVariables=function(e,t){var n=e.split("."),r={};r.mod=n[0],r["do"]=n[1],null!=t&&(r.p=t);var o=JSON.stringify(r),i=new egret.URLVariables("data="+o+"&h="+App.ProxyUserFlag);return i},e}();__reflect(BaseProxy.prototype,"BaseProxy");var BaseEuiAlert=function(e){function t(t,n,r,o){void 0===o&&(o=VIEW_SHOW_TYPE.UP);var i=e.call(this,t,n)||this;return i.isMaskTouch=!0,i.skinName=r,i._layer=n,i._viewShowType=o,i}return __extends(t,e),t.prototype.initUI=function(){e.prototype.initUI.call(this);var t=this;t._maskRect||(t._maskRect=t.getMask(0),t.addChild(t._maskRect)),App.LayerManager.addToLayer(t._maskRect,this._layer),t.myParent.setChildIndex(t._maskRect,0)},t.prototype.initData=function(){e.prototype.initData.call(this);var t=this;App.EffectUtils.viewShowEffect(t,t._viewShowType,t.effectCallBack)},t.prototype.addEvents=function(){e.prototype.addEvents.call(this);var t=this;t.isMaskTouch&&t._maskRect&&t._maskRect.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onMaskHandler,t),t.btn_close&&t.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClosePanel,t)},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this);var t=this;t.btn_close&&t.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onClosePanel,t),t.isMaskTouch&&t._maskRect&&t._maskRect.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onMaskHandler,t)},t.prototype.onMaskHandler=function(){var e=this;App.DisplayUtils.removeFromParent(e._maskRect),e._maskRect=null,App.ViewManager.closeView(e)},t.prototype.onClosePanel=function(){var e=this;App.DisplayUtils.removeFromParent(e._maskRect),e._maskRect=null,App.ViewManager.closeView(e)},t.prototype.getMask=function(e){var t=new eui.Rect;return t.touchEnabled=!0,t.percentWidth=100,t.percentHeight=100,t.fillColor=0,t.fillAlpha=e,t},Object.defineProperty(t.prototype,"maskRect",{get:function(){return this._maskRect},set:function(e){this._maskRect=e},enumerable:!0,configurable:!0}),t}(BaseEuiView);__reflect(BaseEuiAlert.prototype,"BaseEuiAlert");var GameConfig=function(){function e(){}return e.systemType=function(){var e=window.navigator.userAgent.toLowerCase();""+e.match(/MicroMessenger/i);return""+e.match(/windows nt/i)=="windows nt"?"windows":""+e.match(/iphone/i)=="iphone"?"ios":""+e.match(/android/i)=="android"?"android":""+e.match(/ipad/i)=="ipad"?"ipad":""+e.match(/linux/i)=="linux"?"linux":""+e.match(/mac/i)=="mac"?"mac":""+e.match(/ucbrower/i)=="ucbrower"?"ucbrower":void Log.trace("未知系统类型")},e.platformType=function(){var e=window.navigator.userAgent.toLowerCase();return""+e.match(/micromessenger/i)=="micromessenger"?"micromessenger":""+e.match(/qzone/i)=="qzone"?"qzone":""+e.match(/weibo/i)=="weibo"?"weibo":""+e.match(/qq/i)=="qq"?"qq":""+e.match(/renren/i)=="renren"?"renren":""+e.match(/txmicroblog/i)=="txmicroblog"?"txmicroblog":""+e.match(/douban/i)=="douban"?"douban":"other"},e.Language="cn",e.Version="20180414",e}();__reflect(GameConfig.prototype,"GameConfig");var TSDictionary=function(){function e(){this.keys=[],this.values=[],this._len=0}return e.prototype.Add=function(e,t){var n=this;n.keys.push(e),n.values.push(t),n._len++},e.prototype.Remove=function(e){var t=this,n=t.keys.indexOf(e,0);-1!=n&&(t.keys.splice(n,1),t.values.splice(n,1),t._len--)},e.prototype.TryGetValue=function(e){var t=this,n=t.keys.indexOf(e,0);return-1!=n?t.values[n]:null},e.prototype.TryGetKey=function(e){var t=this,n=t.values.indexOf(e,0);return-1!=n?t.keys[n]:null},e.prototype.TryGetListByCondition=function(e){for(var t=this,n=[],r=0,o=t.values;r<o.length;r++){var i=o[r];e(i)&&(n[n.length]=i)}return n},e.prototype.TryGetAnyByCondition=function(e){for(var t=this,n={},r=0,o=t.keys;r<o.length;r++){var i=o[r],a=t.keys.indexOf(i,0);e(t.values[a])&&(n[i]=t.values[a])}return n},e.prototype.TryGetKeyListByCondition=function(e){for(var t=this,n=[],r=0;r<t.keys.length;r++)e(t.keys[r])&&(n[n.length]=t.values[r]);return n},e.prototype.ContainsKey=function(e){for(var t=this,n=t.keys,r=0;r<n.length;++r)if(n[r]==e)return!0;return!1},e.prototype.SetDicValue=function(e,t){var n=this.keys.indexOf(e,0);return-1!=n?(this.keys[n]=e,this.values[n]=t,!0):(this.Add(e,t),!0)},e.prototype.SortByKey=function(){for(var e=this,t=e.keys.length-1;t>0;t--)for(var n=0;t>n;n++)if(Number(e.keys[n])>Number(e.keys[n+1])){var r=e.keys[n],o=e.values[n];e.keys[n]=e.keys[n+1],e.values[n]=e.values[n+1],e.keys[n+1]=r,e.values[n+1]=o}return!0},e.prototype.GetLenght=function(){return this._len},e.prototype.getValueByIndex=function(e){var t=this;if(!(0>e||e>=t._len)){var n=t.values[e];return n}},e.prototype.getKeyByIndex=function(e){var t=this;if(!(0>e||e>=t._len)){var n=t.keys[e];return n}},e.prototype.getValues=function(){return this.values},e.prototype.getkeys=function(){return this.keys},e.prototype.clear=function(){for(var e=this;e.keys.length>0;)e.keys.pop();for(;e.values.length>0;){var t=e.values.pop();t=null}e.keys.length=0,e.values.length=0,e._len=0},e}();__reflect(TSDictionary.prototype,"TSDictionary");var BaseScene=function(){function e(){this._layers=new Array}return e.prototype.onEnter=function(){},e.prototype.onExit=function(){App.ViewManager.closeAll(),this.removeAllLayer()},e.prototype.addLayer=function(e){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChild(e),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChild(e),this._layers.push(e))},e.prototype.addLayerAt=function(e,t){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().addChildAt(e,t),this._layers.push(e)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().addChildAt(e,t),this._layers.push(e))},e.prototype.removeLayer=function(e){e instanceof BaseSpriteLayer?(App.StageUtils.getStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1)):e instanceof BaseEuiLayer&&(App.StageUtils.getUIStage().removeChild(e),this._layers.splice(this._layers.indexOf(e),1))},e.prototype.layerRemoveAllChild=function(e){e instanceof BaseSpriteLayer?e.removeChildren():e instanceof BaseEuiLayer&&e.removeChildren()},e.prototype.removeAllLayer=function(){for(;this._layers.length;){var e=this._layers[0];this.layerRemoveAllChild(e),this.removeLayer(e)}},e}();__reflect(BaseScene.prototype,"BaseScene");var BaseSound=function(){function e(){this._cache={},this._loadingCache=new Array,App.TimerManager.doTimer(6e4,0,this.dealSoundTimer,this)}return e.prototype.dealSoundTimer=function(){for(var e=egret.getTimer(),t=Object.keys(this._cache),n=0,r=t.length;r>n;n++){var o=t[n];this.checkCanClear(o)&&e-this._cache[o]>=SoundManager.CLEAR_TIME&&(delete this._cache[o],RES.destroyRes(o))}},e.prototype.getSound=function(e){var t=GlobleVOData.getData(GlobleVOData.SoundVO,Number(e));if(null==t)return null;var n=RES.getRes(PathConfig.SoundPath+t.file);if(n)this._cache[e]&&(this._cache[e]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(e))return null;this._loadingCache.push(e),RES.getResAsync(e,this.onResourceLoadComplete,this)}return n},e.prototype.onResourceLoadComplete=function(e,t){var n=this._loadingCache.indexOf(t);-1!=n&&(this._loadingCache.splice(n,1),this._cache[t]=egret.getTimer(),this.loadedPlay(t))},e.prototype.loadedPlay=function(e){},e.prototype.checkCanClear=function(e){return!0},e}();__reflect(BaseSound.prototype,"BaseSound");var starlingswf;!function(e){var t=function(t){function n(e,n,r,o){var i=t.call(this)||this;return i._isPlay=!1,i.loop=!0,i._completeFunction=null,i._frames=e,i._labels=n,i._displayObjects=r,i._startFrame=0,i._endFrame=i._frames.length-1,i._ownerSwf=o,i.setCurrentFrame(0),i.play(),i}return __extends(n,t),n.prototype.update=function(){if(this._isPlay)if(this._currentFrame>this._endFrame){if(this.hasCompleteListener()&&this.dispatchEventWith(egret.Event.COMPLETE),this._currentFrame=this._startFrame,!this.loop)return void(this._ownerSwf&&this.stop(!1));if(this._startFrame==this._endFrame)return void(this._ownerSwf&&this.stop(!1));this.setCurrentFrame(this._startFrame)}else this.setCurrentFrame(this._currentFrame),this._currentFrame+=1},n.prototype.setCurrentFrame=function(t){this.$children.length=0,this._currentFrame=t,this.__frameInfos=this._frames[this._currentFrame];for(var n,r,o,i,a=this.__frameInfos.length,s=0;a>s;s++)n=this.__frameInfos[s],i=n[10],r=this._displayObjects[n[0]][i],r.skewX=n[6],r.skewY=n[7],r.alpha=n[8],r.name=n[9],r.x=n[2],r.y=n[3],n[1]==e.Swf.dataKey_Scale9?(r.width=n[11],r.height=n[12]):(r.scaleX=n[4],r.scaleY=n[5]),this.$children.push(r),r.$parent=this,n[1]==e.Swf.dataKey_TextField&&(o=r,o.width=n[11],o.height=n[12],o.textColor=n[14],o.size=n[15],o.textAlign=n[16],n[19]&&"\r"!=n[19]&&""!=n[19]&&(o.text=n[19]))},n.prototype.getCurrentFrame=function(){return this._currentFrame},n.prototype.play=function(){this._isPlay=!0,this._ownerSwf.swfUpdateManager.addSwfAnimation(this);var t,n,r;for(t in this._displayObjects)if(0==t.indexOf(e.Swf.dataKey_MovieClip)){n=this._displayObjects[t],r=n.length;for(var o=0;r>o;o++)n[o].play()}},n.prototype.stop=function(t){if(void 0===t&&(t=!0),this._isPlay=!1,this._ownerSwf.swfUpdateManager.removeSwfAnimation(this),t){var n,r,o;for(n in this._displayObjects)if(0==n.indexOf(e.Swf.dataKey_MovieClip)){r=this._displayObjects[n],o=r.length;for(var i=0;o>i;i++)r[i].stop(t)}}},n.prototype.gotoAndStop=function(e,t){void 0===t&&(t=!0),this.goTo(e),this.stop(t)},n.prototype.gotoAndPlay=function(e){this.goTo(e),this.play()},n.prototype.goTo=function(e){if("string"==typeof e){var t=this.getLabelData(e);this._currentLabel=t[0],this._currentFrame=this._startFrame=t[1],this._endFrame=t[2]}else"number"==typeof e&&(this._currentFrame=this._startFrame=e,this._endFrame=this._frames.length-1);this.setCurrentFrame(this._currentFrame)},n.prototype.getLabelData=function(e){for(var t,n=this._labels.length,r=0;n>r;r++)if(t=this._labels[r],t[0]==e)return t;return null},n.prototype.isPlay=function(){return this._isPlay},n.prototype.totalFrames=function(){return this._frames.length},n.prototype.currentLabel=function(){return this._currentLabel},n.prototype.labels=function(){for(var e=this._labels.length,t=[],n=0;e>n;n++)t.push(this._labels[n][0]);return t},n.prototype.hasCompleteListener=function(){return this.hasEventListener(egret.Event.COMPLETE)},n.prototype.hasLabel=function(e){var t=this.labels();return!(-1==t.indexOf(e))},n.prototype.getLabelStartFrame=function(e){return this.getLabelData(e)[1]},n.prototype.getLabelEndFrame=function(e){return this.getLabelData(e)[2]},n}(e.SwfSprite);e.SwfMovieClip=t,__reflect(t.prototype,"starlingswf.SwfMovieClip",["starlingswf.ISwfAnimation"])}(starlingswf||(starlingswf={}));var BaseClass=function(){function e(){}return e.Instance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;if(!n._instance){var r=e.length;0==r?n._instance=new n:1==r?n._instance=new n(e[0]):2==r?n._instance=new n(e[0],e[1]):3==r?n._instance=new n(e[0],e[1],e[2]):4==r?n._instance=new n(e[0],e[1],e[2],e[3]):5==r&&(n._instance=new n(e[0],e[1],e[2],e[3],e[4]))}return n._instance},e}();__reflect(BaseClass.prototype,"BaseClass");var SoundBG=function(e){function t(){var t=e.call(this)||this;return t._currBg="",t}return __extends(t,e),t.prototype.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},t.prototype.play=function(e){if(this._currBg!=e){this.stop(),this._currBg=e;var t=this.getSound(e);t&&this.playSound(t)}},t.prototype.playSound=function(e){this._currSound=e,this._currSoundChannel=this._currSound.play(),this._currSoundChannel.volume=this._volume},t.prototype.setVolume=function(e){this._volume=e,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},t.prototype.loadedPlay=function(e){this._currBg==e&&this.playSound(RES.getRes(e))},t.prototype.checkCanClear=function(e){return this._currBg!=e},t}(BaseSound);__reflect(SoundBG.prototype,"SoundBG");var Keyboard=function(){function e(){}return e.LEFT=37,e.RIGHT=39,e.UP=38,e.DOWN=40,e.W=87,e.A=65,e.S=83,e.D=68,e.J=74,e.K=75,e.L=76,e.U=85,e.I=73,e.O=79,e.P=80,e.SPACE=32,e}();__reflect(Keyboard.prototype,"Keyboard");var LoadingConst=function(){function e(){}return e.SetProgress=10001,e}();__reflect(LoadingConst.prototype,"LoadingConst");var SceneConsts;!function(e){e[e.BATTLE=1]="BATTLE",e[e.HALL=2]="HALL",e[e.LOADING=3]="LOADING",e[e.LOGIN=4]="LOGIN"}(SceneConsts||(SceneConsts={}));var ViewConst;!function(e){e[e.Loading=1e4]="Loading",e[e.Login=10001]="Login",e[e.Hall=10002]="Hall",e[e.Battle=2e4]="Battle",e[e.MissionPanel=20001]="MissionPanel",e[e.BattleMission=20002]="BattleMission"}(ViewConst||(ViewConst={}));var DisplayLayer=function(e){function t(){var t=e.call(this)||this;t.layerName="",t.layerType=-1;return t}return __extends(t,e),t}(eui.UILayer);__reflect(DisplayLayer.prototype,"DisplayLayer");var LayerManager=function(e){function t(){var t=e.call(this)||this;return t._layers=[],t._sceneContainer=new eui.UILayer,t._gameContainer=new eui.UILayer,t}return __extends(t,e),Object.defineProperty(t.prototype,"sceneContainer",{get:function(){var e=this;return e._sceneContainer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gameContainer",{get:function(){var e=this;return e._gameContainer},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var n=this;this.createAllLayers(),n._sceneContainer.touchThrough=!0,n._gameContainer.touchThrough=!0,e.addChild(n._sceneContainer),e.addChild(n.getLayerByType(t.POP_LAYER)),e.addChild(n.getLayerByType(t.TIP_LAYER)),n._sceneContainer.addChild(n._gameContainer),n._sceneContainer.addChild(n.getLayerByType(t.SCENE_BASE_LAYER)),n._sceneContainer.addChild(n.getLayerByType(t.SCENE_UI_LAYER)),n._sceneContainer.addChild(n.getLayerByType(t.SCENE_UI_EFFECT_LAYER)),n._sceneContainer.addChild(n.getLayerByType(t.SCENE_POP_LAYER)),n._gameContainer.addChild(n.getLayerByType(t.GAME_MAP_LAYER)),n._gameContainer.addChild(n.getLayerByType(t.GAME_EFFECT_LAYER)),n._gameContainer.addChild(n.getLayerByType(t.GAME_MASCOT_LAYER)),n._gameContainer.addChild(n.getLayerByType(t.GAME_UI_LAYER)),n._gameContainer.addChild(n.getLayerByType(t.GAME_POP_LAYER)),e.addEventListener(egret.Event.RESIZE,n.onStageResize,n)},t.prototype.onStageResize=function(e){this.resize()},t.prototype.createAllLayers=function(){for(var e=0;e<t.layerCount;e++)this._layers.push(this.createOnLayer(e))},t.prototype.createOnLayer=function(e){var t=new DisplayLayer;return t.layerType=e,t.touchThrough=!0,t},t.prototype.addToLayer=function(e,t){var n=this.getLayerByType(t);n.addChild(e)},t.prototype.getLayerByType=function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t].layerType==e)return this._layers[t]},t.prototype.resize=function(){Log.trace("【 LayerManager 】stageResized-------------");for(var e=App.StageUtils.getWidth(),t=App.StageUtils.getHeight(),n=0;n<this._layers.length;n++)for(var r=this._layers[n],o=0;o<r.numChildren;o++){var i=r.getChildAt(o);instanceOfIStageResizeable(i)&&i.resize(e,t)}},t.TIP_LAYER=0,t.POP_LAYER=1,t.SCENE_POP_LAYER=2,t.SCENE_UI_EFFECT_LAYER=3,t.SCENE_UI_LAYER=4,t.SCENE_BASE_LAYER=5,t.GAME_POP_LAYER=6,t.GAME_UI_LAYER=7,t.GAME_EFFECT_LAYER=8,t.GAME_MASCOT_LAYER=10,t.GAME_MAP_LAYER=9,t.layerCount=11,t}(BaseClass);__reflect(LayerManager.prototype,"LayerManager");var DelayOptManager=function(e){function t(){var t=e.call(this)||this;return t.TIME_THRESHOLD=2,t._delayOpts=[],App.TimerManager.doFrame(1,0,t.runCachedFun,t),t}return __extends(t,e),t.prototype.addDelayOptFunction=function(e,t,n,r,o){this._delayOpts.push({fun:t,funPara:n,thisObj:e,callBack:r,para:o})},t.prototype.clear=function(){this._delayOpts.length=0},t.prototype.stop=function(){App.TimerManager.remove(this.runCachedFun,this)},t.prototype.runCachedFun=function(e){if(0!=this._delayOpts.length)for(var t,n=egret.getTimer();this._delayOpts.length&&(t=this._delayOpts.shift(),t.funPara?t.fun.call(t.thisObj,t.funPara):t.fun.call(t.thisObj),t.callBack&&(void 0!=t.para?t.callBack.call(t.thisObj,t.para):t.callBack()),!(egret.getTimer()-n>this.TIME_THRESHOLD)););},t}(BaseClass);__reflect(DelayOptManager.prototype,"DelayOptManager");var GameEnterManager=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){App.BoneManager.start(),App.PlayerInfoManager.setup()},t}(BaseClass);__reflect(GameEnterManager.prototype,"GameEnterManager");var LanguageManager=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._languageMap=new TSDictionary,t._reg=new RegExp("\\{(\\d+)\\}"),t}return __extends(t,e),t.prototype.setup=function(e){var t=this,n=String(e).split("\r\n");if(n.length)for(var r=0;r<n.length;r++){var o=n[r];if("#"!=o&&""!=o){var i=o.split(":");t._languageMap.ContainsKey(i[0])&&t._languageMap.Remove(i[0]),i.length<=2?t._languageMap.Add(i[0],i[1]):t._languageMap.Add(i[0],i.slice(1).join(""))}}},t.prototype.getLanguageMapData=function(){var e=this;return e._languageMap.getValues()},t.prototype.getLanguageById=function(e){var t=this;return t._languageMap.TryGetValue(e)},t.prototype.setModuleLanguage=function(e){var n=this;e&&(!e||e.numChildren)&&t.isOpenLanguage&&n.SearchAndModifyNodeLanguage(e)},t.prototype.SearchAndModifyNodeLanguage=function(e){for(var t=0;t<e.numChildren;t++){var n=e.getChildAt(t);if(n instanceof egret.DisplayObjectContainer&&this.SearchAndModifyNodeLanguage(n),n instanceof eui.Label){if(""!=n.name){var r=n.name.split("@")[1];r&&(n.text=this.getLanguageById(r))}}else if(n instanceof eui.EditableText){if(""!=n.name){var r=n.name.split("@")[1];r&&(n.prompt=this.getLanguageById(r))}}else if(n instanceof eui.Button&&""!=n.name){var r=n.name.split("@")[1];r&&(n.label=this.getLanguageById(r))}}},t.prototype.getLanguageText=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this;return r.getTranslationWithArray(e,t)},t.prototype.getTranslationWithArray=function(e,t){var n=this;return n._languageMap.ContainsKey(e)?n.replaceStr(n._languageMap.TryGetValue(e),t):void 0},t.prototype.languageReplace=function(e,t){var n=this;return n.replaceStr(e,t)},t.prototype.replaceStr=function(e,t){var n=this;if(t&&t.length>0)for(var r=n._reg.exec(e);r&&t.length>0;){var o=Number(r[1]),i=String(t[o]);if(o>=0&&o<t.length){var a=i.indexOf("$");a>-1&&(i=i.slice(0,a)+"$"+i.slice(a)),e=e.replace(n._reg,i)}else e=e.replace(n._reg,"{}");r=n._reg.exec(e)}return e},t.isOpenLanguage=!0,t}(BaseClass);__reflect(LanguageManager.prototype,"LanguageManager");var MessageManger=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._textDisplayDic=new TSDictionary,t._maxNum=5,t}return __extends(t,e),t.prototype._creatOneTextDisplay=function(){var e=ObjectPool.pop(eui.Label,"eui.Label");return e.textColor=16777215,e.stroke=3,e.strokeColor=4199171,e.size=40,e.fontFamily="黑体",e.horizontalCenter=0,e.verticalCenter=0,e.touchEnabled=!1,e.width=App.StageUtils.getWidth(),e.wordWrap=!0,e.textAlign="center",e.y=App.StageUtils.getHeight()/2,e},t.prototype.showText=function(e){var t=this.getOne(e);t.text=e;var n={display:t,isplaying:!0};this._textDisplayDic.Add(e,n),this.startAnimation(e,t)},t.prototype.startAnimation=function(e,t){var n=this;App.LayerManager.addToLayer(t,LayerManager.GAME_POP_LAYER),t.alpha=1,egret.Tween.get(t).wait(1e3).to({alpha:0},1e3),egret.Tween.get(t).to({verticalCenter:-100},2e3).call(function(){egret.Tween.removeTweens(t),ObjectPool.push(t),t.alpha=1,t.verticalCenter=0,App.DisplayUtils.removeFromParent(t),n.onAnimationComplete(e)})},t.prototype.onAnimationComplete=function(e){var t=this._textDisplayDic.TryGetValue(e);t&&(t.isplaying=!1,this._textDisplayDic.Remove(e))},t.prototype.removeTips=function(){for(var e=this,t=0;t<e._textDisplayDic.GetLenght();t++){var n=e._textDisplayDic.getValueByIndex(t);n.display.parent&&n.display.parent.removeChild(n.display),n.display.alpha=1,n.display.verticalCenter=0,delete n.display.$children}e._textDisplayDic.clear()},t.prototype.getOne=function(e){return this._creatOneTextDisplay()},t}(BaseClass);__reflect(MessageManger.prototype,"MessageManger");var PlayerInfoManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setup=function(){},t}(BaseClass);__reflect(PlayerInfoManager.prototype,"PlayerInfoManager");var RegisterManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initScene=function(){App.SceneManager.register(SceneConsts.LOADING,new LoadingScene),App.SceneManager.register(SceneConsts.LOGIN,new LoginScene),App.SceneManager.register(SceneConsts.HALL,new HallScene),App.SceneManager.register(SceneConsts.BATTLE,new BattleScene)},t.prototype.initModules=function(){App.ControllerManager.register(ControllerConst.Loading,new LoadingController),App.ControllerManager.register(ControllerConst.Login,new LoginController),App.ControllerManager.register(ControllerConst.Hall,new HallController),App.ControllerManager.register(ControllerConst.Battle,new BattleController)},t}(BaseClass);__reflect(RegisterManager.prototype,"RegisterManager");var RenderTextureManager=function(e){function t(){var t=e.call(this)||this;return t._pool=[],t._useNum=0,t.isLowerQQBrowser()?t._maxNum=18:t._maxNum=-1,t}return __extends(t,e),t.prototype.isLowerQQBrowser=function(){if(App.DeviceUtils.IsQQBrowser){for(var e=["2013022","Lenovo A630t","SM-G3818","vivo X3t","GT-I9100"],t=!1,n=0,r=e.length;r>n;n++)if(-1!=navigator.userAgent.indexOf(e[n])){t=!0;break}return t}return!1},t.prototype.pop=function(){var e=this._pool.pop();return e||(-1==this._maxNum||this._useNum<this._maxNum)&&(e=new egret.RenderTexture,this._useNum++),e},t.prototype.push=function(e){for(var t=!1,n=0,r=this._pool.length;r>n;n++)if(this._pool[n]==e){t=!0;break}t||this._pool.push(e)},t}(BaseClass);__reflect(RenderTextureManager.prototype,"RenderTextureManager");var TimerManager=function(e){function t(){var t=e.call(this)||this;return t._handlers=new Array,t._delHandlers=new Array,t._currTime=egret.getTimer(),t._currFrame=0,t._count=0,t._timeScale=1,egret.Ticker.getInstance().register(t.onEnterFrame,t),t}return __extends(t,e),t.prototype.setTimeScale=function(e){this._timeScale=e},t.prototype.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer(),App.DebugUtils.start("TimerManager:");for(var e=0;e<this._count;e++){var t=this._handlers[e],n=t.userFrame?this._currFrame:this._currTime;n>=t.exeTime&&(App.DebugUtils.start(t.method.toString()),t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),App.DebugUtils.stop(t.method.toString()),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(t.repeatCount>1?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}App.DebugUtils.stop("TimerManager:")},t.prototype.create=function(e,t,n,r,o,i,a){if(!(0>t||0>n||null==r)){this.remove(r,o);var s=ObjectPool.pop(TimerHandler,"TimerHandler");s.userFrame=e,s.repeat=0==n,s.repeatCount=n,s.delay=t,s.method=r,s.methodObj=o,s.complateMethod=i,s.complateMethodObj=a,s.exeTime=t+(e?this._currFrame:this._currTime),s.dealTime=this._currTime,this._handlers.push(s),this._count++}},t.prototype.doTimer=function(e,t,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=null),this.create(!1,e,t,n,r,o,i)},t.prototype.doFrame=function(e,t,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=null),this.create(!0,e,t,n,r,o,i)},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t.prototype.remove=function(e,t){for(var n=0;n<this._count;n++){var r=this._handlers[n];if(r.method==e&&r.methodObj==t){this._handlers.splice(n,1),ObjectPool.push(r),this._count--;break}}},t.prototype.removeAll=function(e){for(var t=0;t<this._count;t++){var n=this._handlers[t];n.methodObj==e&&(this._handlers.splice(t,1),ObjectPool.push(n),this._count--,t--)}},t.prototype.isExists=function(e,t){for(var n=0;n<this._count;n++){var r=this._handlers[n];if(r.method==e&&r.methodObj==t)return!0}return!1},t}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return e.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();__reflect(TimerHandler.prototype,"TimerHandler");var GlobleVOData=function(e){function t(){var t=e.call(this)||this;return t._hasParasComplete=!1,t._totalStepCsvList=new TSDictionary,t._needParseCount=0,t._currParseCount=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"hasParasComplete",{get:function(){return this._hasParasComplete
},enumerable:!0,configurable:!0}),t.prototype.setup=function(){var e=this;e.initModel(),e.initStep()},t.prototype.initModel=function(){var e=this;e._totalStepCsvList.Add(t.BoneAnimationVO,BoneAnimationVO),e._totalStepCsvList.Add(t.SoundVO,SoundVO),e._totalStepCsvList.Add(t.ServerConfigVO,ServerConfigVO),e._totalStepCsvList.Add(t.MapVO,MapVO)},t.prototype.initStep=function(){var e=this;e._needParseCount=e._totalStepCsvList.GetLenght(),RES.getResAsync("json_zip",this.onloadDataComplete,e),Log.trace("dataFile is json_zip")},t.prototype.onloadDataComplete=function(e,t){var n=this;n._csvZipData=new JSZip(e),Log.trace("onloadDataComplete is json_zip:"+t),n.addEventListener(egret.Event.ENTER_FRAME,n.onEnterFrameLoader,n)},t.prototype.onEnterFrameLoader=function(){var e=this;e._currParseCount>=e._needParseCount?(e.removeEventListener(egret.Event.ENTER_FRAME,e.onEnterFrameLoader,e),this._hasParasComplete=!0,App.GameEnterManager.init()):(e.getCsvFile(),e.getCsvFile())},t.prototype.getCsvFile=function(){var e=this;if(e._currParseCount<e._needParseCount){var t=e._totalStepCsvList.getKeyByIndex(e._currParseCount);t=t.replace("_",".");var n=e._csvZipData.file(t);null==n&&Log.trace("can't get key from key :"+t);var r=e._csvZipData.file(t).asText();e.starSingleParse(r)}},t.prototype.starSingleParse=function(e){var n=this,r=n._totalStepCsvList.getKeyByIndex(n._currParseCount),o=n._totalStepCsvList.getValueByIndex(n._currParseCount),i=CSVParser.ParseJsonData(o,e);t.AllCacheData.Add(r,i),n._currParseCount++},Object.defineProperty(t,"getInstance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.getData=function(e,n){var r=t.AllCacheData.TryGetValue(e);return r.TryGetValue(n)},t.getDataByFilter=function(e,n,r){var o=t.AllCacheData.TryGetValue(e),i=o.TryGetListByCondition(function(e){return e[n]==r});return i},t.getAllValue=function(e){var n=t.AllCacheData.TryGetValue(e);return n.getValues()},t.getDataByCondition=function(e,n){var r=t.AllCacheData.TryGetValue(e),o=r.TryGetListByCondition(n);return o},t.AllCacheData=new TSDictionary,t.ServerConfigVO="ServerConfig_json",t.BoneAnimationVO="BoneAnimation_json",t.SoundVO="Sound_json",t.MapVO="Map_json",t}(egret.DisplayObject);__reflect(GlobleVOData.prototype,"GlobleVOData");var BoneAnimationVO=function(){function e(){this._positionOffset=""}return Object.defineProperty(e.prototype,"currentAnimationName",{get:function(){return this._currentAnimationName},set:function(e){"0"!=e&&(this._currentAnimationName=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"detectFrameEvent",{get:function(){return this._detectFrameEvent},set:function(e){this._detectFrameEvent=1==Number(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"removeAtLastFrame",{get:function(){return this._removeAtLastFrame},set:function(e){this._removeAtLastFrame=1==Number(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPauseAtLastFrame",{get:function(){return this._isPauseAtLastFrame},set:function(e){this._isPauseAtLastFrame=1==Number(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"removeWhenRemoveFromStage",{get:function(){return this._removeWhenRemoveFromStage},set:function(e){this._removeWhenRemoveFromStage=1==Number(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionOffset",{get:function(){return this._positionOffset},set:function(e){"0"!=e&&(this._positionOffset=e)},enumerable:!0,configurable:!0}),e}();__reflect(BoneAnimationVO.prototype,"BoneAnimationVO");var MapVO=function(){function e(){}return Object.defineProperty(e.prototype,"path",{get:function(){return this._path},set:function(e){this._path=ObjectUtils.splitToString(e,"#")},enumerable:!0,configurable:!0}),e}();__reflect(MapVO.prototype,"MapVO");var ServerConfigVO=function(){function e(){}return e}();__reflect(ServerConfigVO.prototype,"ServerConfigVO");var SoundVO=function(){function e(){}return e}();__reflect(SoundVO.prototype,"SoundVO");var ControllerManager=function(e){function t(){var t=e.call(this)||this;return t._modules={},t}return __extends(t,e),t.prototype.clear=function(){this._modules={}},t.prototype.register=function(e,t){this.isExists(e)||(this._modules[e]=t)},t.prototype.unregister=function(e){this.isExists(e)&&(this._modules[e]=null,delete this._modules[e])},t.prototype.isExists=function(e){return null!=this._modules[e]},t.prototype.applyFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=this._modules[e];if(o){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];return o.applyFunc.apply(o,i)}return Log.trace("模块"+e+"不存在"),null},t.prototype.getControllerModel=function(e){var t=this._modules[e];return t?t.getModel():null},t}(BaseClass);__reflect(ControllerManager.prototype,"ControllerManager");var ViewManager=function(e){function t(){var t=e.call(this)||this;return t._views={},t._opens=[],t}return __extends(t,e),t.prototype.clear=function(){this.closeAll(),this._views={}},t.prototype.register=function(e,t){null!=t&&(this._views[e]||(this._views[e]=t))},t.prototype.unregister=function(e){this._views[e]&&(this._views[e]=null,delete this._views[e])},t.prototype.destroy=function(e,t){void 0===t&&(t=null);var n=this.getView(e);n&&(this.unregister(e),n.destroy(),n=null),this.register(e,t)},t.prototype.open=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.getView(e);return null==r?void Log.trace("UI_"+e+"不存在"):r.isShow()?(r.open.apply(r,t),r):(r.isInit()?(r.addToParent(),r.initUI(),r.addEvents(),r.open.apply(r,t),r.initData()):(App.GameLoading.showLoading(),r.loadResource(function(){r.setVisible(!1),r.addToParent()}.bind(this),function(){r.initUI(),r.addEvents(),r.open.apply(r,t),r.initData(),r.setVisible(!0),App.GameLoading.hideLoading()}.bind(this))),this._opens.push(e),r)},t.prototype.close=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.isShow(e)){var r=this.getView(e);if(null!=r){var o=this._opens.indexOf(e);o>=0&&this._opens.splice(o,1),r.removeFromParent(),r.close.apply(r,t)}}},t.prototype.closeView=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=Object.keys(this._views),o=0,i=r.length;i>o;o++){var a=parseInt(r[o]);if(this._views[a]==e)return void this.close(a,t)}},t.prototype.getView=function(e){return this._views[e]},t.prototype.closeAll=function(){for(;this._opens.length;)this.close(this._opens[0])},t.prototype.currOpenNum=function(){return this._opens.length},t.prototype.isShow=function(e){return-1!=this._opens.indexOf(e)},t}(BaseClass);__reflect(ViewManager.prototype,"ViewManager");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function o(e){t.call(r,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(r))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(l,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var SkinName=function(){function e(){}return e.LoadingUISkin="resource/skins/loading/LoadingUISkin.exml",e.LoginViewSkin="resource/skins/login/LoginViewSkin.exml",e.CurrencyComSkin="resource/skins/common/component/CurrencyComSkin.exml",e.HallViewSkin="resource/skins/hall/HallViewSkin.exml",e.ButtonComSkin="resource/skins/common/component/ButtonComSkin.exml",e.BattleMapSkin="resource/skins/battle/BattleMapSkin.exml",e.BattleViewSkin="resource/skins/battle/BattleViewSkin.exml",e.MapBtnItemSkin="resource/skins/battle/item/MapBtnItemSkin.exml",e.MissionPanelSkin="resource/skins/battle/panel/MissionPanelSkin.exml",e.BattleMissionViewSkin="resource/skins/battle/BattleMissionViewSkin.exml",e}();__reflect(SkinName.prototype,"SkinName");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?r(o):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var PathConfig=function(){function e(){}return Object.defineProperty(e,"ConfigUrls",{get:function(){return[e.Root+"config/game_com.res.json",e.Root+"config/game_animation.res.json",e.Root+GameConfig.Language+"/config/default.res.json",e.Root+GameConfig.Language+"/config/game_ui.res.json"]},enumerable:!0,configurable:!0}),e.Root="resource/",e.ThemePath=e.Root+"config/default.thm.json",e.GameComPath=e.Root+"config/game_com.res.json",e.Language=e.Root+GameConfig.Language+"/config/language.txt",e.SoundPath=e.Root+"common/sound/",e.ItemPath=e.Root+"common/item/{0}.png",e.MapPath=e.Root+"common/map/{0}.jpg",e}();__reflect(PathConfig.prototype,"PathConfig");var App=function(){function e(){}return Object.defineProperty(e,"Http",{get:function(){return Http.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StageUtils",{get:function(){return StageUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MessageManger",{get:function(){return MessageManger.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LayerManager",{get:function(){return LayerManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ControllerManager",{get:function(){return ControllerManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RegisterManager",{get:function(){return RegisterManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SocketManager",{get:function(){return SocketManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PlayerInfoManager",{get:function(){return PlayerInfoManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LanguageManager",{get:function(){return LanguageManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GameEnterManager",{get:function(){return GameEnterManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EffectUtils",{get:function(){return EffectUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StringUtils",{get:function(){return StringUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SoundManager",{get:function(){return SoundManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CommonUtils",{get:function(){return CommonUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"KeyboardUtils",{get:function(){return KeyboardUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DeviceUtils",{get:function(){return DeviceUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RockerUtils",{get:function(){return RockerUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MathUtils",{get:function(){return MathUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TimerManager",{get:function(){return TimerManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DebugUtils",{get:function(){return DebugUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RandomUtils",{get:function(){return RandomUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShockUtils",{get:function(){return ShakeUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MessageCenter",{get:function(){return MessageCenter.Instance(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GameLoading",{get:function(){return GameLoading.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DisplayUtils",{get:function(){return DisplayUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ViewManager",{get:function(){return ViewManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderTextureManager",{get:function(){return RenderTextureManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SceneManager",{get:function(){return SceneManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DelayOptManager",{get:function(){return DelayOptManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"BoneManager",{get:function(){return BoneManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"StarlingSwfFactory",{get:function(){return StarlingSwfFactory.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EgretExpandUtils",{get:function(){return ExpandUtils.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ResUtil",{get:function(){return ResUtil.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"GridManager",{get:function(){return GridManager.Instance()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NotificationCenter",{get:function(){return null==e._notificationCenter&&(e._notificationCenter=new MessageCenter(1)),e._notificationCenter},enumerable:!0,configurable:!0}),e.Init=function(){e.GlobalData=RES.getRes("global"),e.DebugUtils.isOpen(e.GlobalData.IsDebug),e.DebugUtils.setThreshold(5),e.EgretExpandUtils.init()},e.ProxyUserFlag="",e.GlobalData=null,e}();__reflect(App.prototype,"App");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this);var t=this,n=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",n),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),t.initLifecycle(),t.initData(),t.initPlatform()},t.prototype.initLifecycle=function(){egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()}},t.prototype.initData=function(){egret.ImageLoader.crossOrigin="anonymous",App.StageUtils.startFullscreenAdaptation(720,1280,null),App.StageUtils.setFrameRate(60),App.StageUtils.setScaleMode(egret.StageScaleMode.FIXED_WIDTH),App.LayerManager.setup(App.StageUtils.getStage())},t.prototype.initPlatform=function(){var e=this;switch(ext.getPlatform()){case"wan83":break;case"facebook":break;case"wx":ext.getLogin(function(e,t){ext.getUserInfo(t.userInfoBack,t)},e);break;default:e.runGame()}},t.prototype.runGame=function(e){return void 0===e&&(e="resource/"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return PathConfig.Root=e,[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,6,,7]),[4,this.loadGameComConfig()];case 1:return n.sent(),[4,RES.loadGroup("loading")];case 2:return n.sent(),e=new LoadingUI,this.stage.addChild(e),[4,this.loadConfigs()];case 3:return n.sent(),[4,this.loadTheme()];case 4:return n.sent(),[4,this.loadCommonGroup(e)];case 5:return n.sent(),this.stage.removeChild(e),[3,7];case 6:return t=n.sent(),console.error(t),[3,7];case 7:return[2]}})})},t.prototype.loadGameComConfig=function(){var e=this;return new Promise(function(t,n){App.ResUtil.addConfig(PathConfig.GameComPath,PathConfig.Root),App.ResUtil.loadConfig(function(){t()},e)})},t.prototype.loadConfigs=function(){var e=this;return new Promise(function(t,n){for(var r=PathConfig.ConfigUrls,o=0;o<r.length;o++)App.ResUtil.addConfig(r[o],PathConfig.Root);App.ResUtil.loadConfig(function(){t()},e)})},t.prototype.loadCommonGroup=function(e){var t=this;return new Promise(function(n,r){App.ResUtil.loadGroup(["common","global"],function(){n()},t,0,e)})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme(PathConfig.ThemePath,e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){GlobleVOData.getInstance.setup(),RES.getResByUrl(PathConfig.Language,function(e,n){App.LanguageManager.setup(e),t()},e,RES.ResourceItem.TYPE_TEXT)},e)})},t.prototype.createGameScene=function(){App.Init(),App.RegisterManager.initScene(),App.RegisterManager.initModules(),App.SoundManager.setBgOn(!0),App.SoundManager.setEffectOn(!0),App.SceneManager.runScene(SceneConsts.LOGIN)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var BaseSpriteView=function(e){function t(t,n){var r=e.call(this)||this;return r._resources=null,r._controller=t,r._myParent=App.LayerManager.getLayerByType(n),r._isInit=!1,App.StageUtils.getStage().addEventListener(egret.Event.RESIZE,r.onResize,r),r}return __extends(t,e),t.prototype.setResources=function(e){this._resources=e},Object.defineProperty(t.prototype,"myParent",{get:function(){return this._myParent},enumerable:!0,configurable:!0}),t.prototype.isInit=function(){return this._isInit},t.prototype.registerFunc=function(e,t,n){this._controller.registerFunc(e,t,n)},t.prototype.applyFunc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._controller.applyFunc.apply(this._controller,arguments)},t.prototype.applyControllerFunc=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this._controller.applyControllerFunc.apply(this._controller,arguments)},t.prototype.isShow=function(){return null!=this.stage&&this.visible},t.prototype.addToParent=function(){this._myParent.addChild(this)},t.prototype.removeFromParent=function(){App.DisplayUtils.removeFromParent(this)},t.prototype.initUI=function(){this._isInit=!0},t.prototype.initData=function(){this.addEvents()},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.addEvents=function(){},t.prototype.removeEvents=function(){},t.prototype.close=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.destroy=function(){this.removeEvents(),this._controller=null,this._myParent=null,this._resources=null},t.prototype.onResize=function(){},t.prototype.loadResource=function(e,t){this._resources&&this._resources.length>0?App.ResUtil.loadGroup(this._resources,function(){e(),t()},this):(e(),t())},t.prototype.setVisible=function(e){this.visible=e},Object.defineProperty(t.prototype,"controller",{get:function(){return this._controller},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);__reflect(BaseSpriteView.prototype,"BaseSpriteView",["IBaseView"]);var MessageCenter=function(e){function t(t){var n=e.call(this)||this;return n.type=t,n.dict={},n.eVec=new Array,n.lastRunTime=0,0==n.type&&App.TimerManager.doFrame(1,0,n.run,n),n}return __extends(t,e),t.prototype.clear=function(){this.dict={},this.eVec.splice(0)},t.prototype.addListener=function(e,t,n){var r=this.dict[e];null==r&&(r=new Array,this.dict[e]=r);var o=0,i=r.length;for(o;i>o;o++)if(r[o][0]==t&&r[o][1]==n)return;r.push([t,n])},t.prototype.removeListener=function(e,t,n){var r=this.dict[e];if(null!=r){var o=0,i=r.length;for(o;i>o;o++)if(r[o][0]==t&&r[o][1]==n){r.splice(o,1);break}0==r.length&&(this.dict[e]=null,delete this.dict[e])}},t.prototype.removeAll=function(e){for(var t=Object.keys(this.dict),n=0,r=t.length;r>n;n++){for(var o=t[n],i=this.dict[o],a=0;a<i.length;a++)i[a][1]==e&&(i.splice(a,1),a--);0==i.length&&(this.dict[o]=null,delete this.dict[o])}},t.prototype.dispatch=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(null!=this.dict[e]){var r=ObjectPool.pop(MessageVo,"MessageVo");r.type=e,r.param=t,0==this.type?this.eVec.push(r):1==this.type?this.dealMsg(r):Log.trace("MessageCenter未实现的类型")}},t.prototype.run=function(){var e=egret.getTimer(),t=e-this.lastRunTime>100;if(this.lastRunTime=e,t)for(;this.eVec.length>0;)this.dealMsg(this.eVec.shift());else for(;this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-e>5)););},t.prototype.dealMsg=function(e){for(var t=this.dict[e.type],n=0,r=t.length,o=null;r>n;)o=t[n],o[0].apply(o[1],e.param),t.length!=r&&(r=t.length,n--),n++;e.dispose(),ObjectPool.push(e)},t}(BaseClass);__reflect(MessageCenter.prototype,"MessageCenter");var MessageVo=function(){function e(){}return e.prototype.dispose=function(){this.type=null,this.param=null},e}();__reflect(MessageVo.prototype,"MessageVo");var DynamicChange=function(){function e(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}return Object.defineProperty(e.prototype,"pUpdate",{get:function(){return this._pUpdate},enumerable:!0,configurable:!0}),e.prototype.getCacheData=function(e){return this._dataCache[e]?this._dataCache[e]:null},e.prototype.clearCache=function(){for(var e=Object.keys(this._dataCache),t=0,n=e.length;n>t;t++){var r=e[t];this._dataCache[r]=null,delete this._dataCache[r]}},e.prototype.getCacheKeyInfos=function(){for(var e=[],t=Object.keys(this._dataCache),n=0,r=t.length;r>n;n++){var o=t[n],i=this._dataCache[o];e.push(i)}return e},e.prototype.isCache=function(e){return this._dataCache[e]},e}();__reflect(DynamicChange.prototype,"DynamicChange");var ProxyUpdate=function(){function e(e){this._cache=e}return e.prototype.isArray=function(e){return e instanceof Array},e.prototype.isObject=function(e){return e.indexOf("object")>-1},e.prototype.isNormal=function(e){var t=e.indexOf("@")>-1,n=e.indexOf(".")>-1,r=e.indexOf("_")>-1;return!t&&!n&&!r},e.prototype.isAddToArray=function(e){return"@a"==e},e.prototype.isRemoveToArray=function(e){var t=e.split("_");return t.length<=3&&"@d"==t[0]},e.prototype.isFilter=function(e){var t=e.split("_");return"@f"==t[0]},e.prototype.isNumeric=function(e){return parseFloat(e).toString()==e.toString()},e.prototype._updateObject=function(e,t,n){var r=e.split(".");"@a"==r[0]||"@s"==r[0]?n[r[1]]=t:"@d"==r[0]&&delete n[r[1]]},e.prototype._getFilterObject=function(e,t){if(t){var n=e.split("_");if(3==n.length&&"@f"==n[0]&&this.isArray(t))for(var r=n[1],o=n[2],i=0;i<t.length;i++){var a=t[i];if(3==n.length&&this.isObject(a.toString())){var s=a[r];if(s&&("@"==o[0]&&(o=o.replace("@","")),o==s))return a}}}return null},e.prototype._addObjectToArray=function(e,t){if(this.isArray(t))for(var n=0;n<t.length;n++)e.push(t[n]);else e.push(t)},e.prototype._removeObjectFromArray=function(e,t,n){var r=t.split("_");if(r.length<=3&&"@d"==r[0]&&this.isArray(e))for(var o=e.length,i=o-1;i>=0;i--){var a=e[i];if(3==r.length){if(a.hasOwnProperty(r[1])){var s=r[2];"@"==s[0]&&(s=s.replace("@","")),s==a[r[1]]&&e.splice(i,1)}}else 2==r.length&&a.hasOwnProperty(r[1])?n==a[r[1]]&&e.splice(i,1):1==r.length&&n==a&&e.splice(i,1)}},e.prototype.update=function(e,t){if(this._cache[e]=t,t.hasOwnProperty("c"))for(var n=t.c,r=Object.keys(n),o=0,i=r.length;i>o;o++){var a=r[o];this._cache[a]&&(this._update(this._cache[a],n[a]),App.MessageCenter.dispatch(a+"_HttpUpdate"))}},e.prototype._update=function(e,t){if(e&&t&&this.isObject(t.toString()))for(var n=Object.keys(t),r=0,o=n.length;o>r;r++){var i=n[r],a=t[i];if(this.isNormal(i)&&this.isObject(a.toString()))e.hasOwnProperty(i)&&this._update(e[i],a);else if(this.isNormal(i)&&this.isNumeric(a)){var s=e[i];e[i]=s+a}else if(this.isNormal(i))e[i]=a;else if(this.isAddToArray(i))this._addObjectToArray(e,a);else if(this.isRemoveToArray(i))this._removeObjectFromArray(e,i,a);else if(this.isFilter(i)){var l=this._getFilterObject(i,e);l&&this._update(l,a)}else this._updateObject(i,a,e)}},e}();__reflect(ProxyUpdate.prototype,"ProxyUpdate");var Http=function(e){function t(){var t=e.call(this)||this;return t._data=new DynamicChange,t._cache=[],t._request=new egret.URLRequest,t._request.method=egret.URLRequestMethod.POST,t._urlLoader=new egret.URLLoader,t._urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,t.onError,t),t}return __extends(t,e),t.prototype.initServer=function(e){this._serverUrl=e},Object.defineProperty(t.prototype,"Data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.onError=function(e){this.nextPost()},t.prototype.send=function(e,t){this._cache.push([e,t]),this.post()},t.prototype.post=function(){if(!this._isRequesting&&0!=this._cache.length){var e=this._cache.shift(),t=e[0],n=e[1];this._type=t,this._request.url=this._serverUrl,this._request.data=n,this._urlLoader.addEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this),this._urlLoader.load(this._request),this._isRequesting=!0}},t.prototype.onLoaderComplete=function(e){this._urlLoader.removeEventListener(egret.Event.COMPLETE,this.onLoaderComplete,this);var t=JSON.parse(this._urlLoader.data);t.hasOwnProperty("s")&&0!=t.s?Log.trace("Http错误:"+t.s):(this._data.pUpdate.update(this._type,t),App.MessageCenter.dispatch(this._type,t)),this.nextPost()},t.prototype.nextPost=function(){this._isRequesting=!1,this.post()},t}(BaseClass);__reflect(Http.prototype,"Http");var ByteSocket=function(e){function t(t,n){void 0===n&&(n=!1);var r=e.call(this)||this;r._m_PackageQueue=new Array,r._reconnectCount=0,r._needReconnect=!1,r._maxReconnectCount=10;var o=r;return SocketConsts.DEBUG=n,o._readBuffer=new egret.ByteArray,o._headerTemp=new egret.ByteArray,o._encrypted=t,r}return __extends(t,e),t.prototype.setKey=function(e){var t=this;t.RECEIVE_KEY=new egret.ByteArray,t.SEND_KEY=new egret.ByteArray;for(var n=0;8>n;n++)t.RECEIVE_KEY.writeByte(e[n]),t.SEND_KEY.writeByte(e[n])},t.prototype.resetKey=function(){this.setKey(SocketConsts.KEY)},t.prototype.sendProtobuffer=function(e,t){var n=this;if(null!=t){var r=new egret.ByteArray(t);e.writeBytes(r,0,r.length)}n.send(e)},t.prototype.send=function(e){var t=this;if(t._socket&&t._socket.connected){if(e.pack(),t._encrypted){e.position=0,t.SEND_KEY.position=0;for(var n=void 0,r=void 0,o=void 0,i=void 0,a=void 0,s=new egret.ByteArray,l=new egret.ByteArray,c=new egret.ByteArray,p=0;p<e.length;p++)if(p>0){i=p,a=p%8,e.position=i,t.SEND_KEY.position=a;var u=o;p>=8?(l.position>=8&&c.length>0&&(l.clear(),l=t.copyByteArray(c),c.clear()),l.position=a,r=l.readByte(),r=r+u^p,c.writeByte(r)):(r=t.SEND_KEY.readByte(),r=r+u^p,l.writeByte(r)),n=e.readByte(),n=(n^r)+u,o=n,s.writeByte(n)}else n=e.readByte(),r=t.SEND_KEY.readByte(),n^=r,o=n,s.writeByte(n),l.writeByte(r);var h=new egret.ByteArray;for(c.length>0&&(h=t.copyByteArray(c)),l.position=c.position,p=l.position;p<l.length;p++)h.writeByte(l.readByte());t.SEND_KEY.clear(),t.SEND_KEY=t.copyByteArray(h),h.clear(),l.clear(),c.clear(),t._socket.writeBytes(s,0,s.length)}else e.position=0,t._socket.writeBytes(e,0,e.length);t._socket.flush()}},t.prototype.connect=function(){var e=this;return App.DeviceUtils.IsHtml5&&!window.WebSocket?void Log.trace("不支持WebSocket"):(null!=e._socket&&e.close(),e._socket=new egret.WebSocket,e._socket.type=egret.WebSocket.TYPE_BINARY,e._readBuffer.position=0,e._readOffset=0,e._writeOffset=0,e.addEvents(),void e._socket.connectByUrl(SocketConsts.IP+":"+SocketConsts.PORT+"/weegame"))},t.prototype.addEvents=function(){var e=this;e._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,e.onReceiveMessage,e),e._socket.addEventListener(egret.Event.CONNECT,e.onConnectHandler,e),e._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,e.onSocketError,e),e._socket.addEventListener(egret.Event.CLOSE,e.onSocketClose,e)},t.prototype.removeEvents=function(){var e=this;e._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,e.onReceiveMessage,e),e._socket.removeEventListener(egret.Event.CONNECT,e.onConnectHandler,e),e._socket.removeEventListener(egret.Event.CLOSE,e.onSocketClose,e),e._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,e.onSocketError,e)},t.prototype.onSocketError=function(e){this._needReconnect?this.reconnect():App.MessageCenter.dispatch(SocketConsts.SOCKET_NOCONNECT),this._isConnecting=!1},t.prototype.onSocketClose=function(){Log.trace("服务器断开连接"),this._isConnecting=!1,this._needReconnect?(App.MessageCenter.dispatch(SocketConsts.SOCKET_START_RECONNECT),this.reconnect()):App.MessageCenter.dispatch(SocketConsts.SOCKET_CLOSE)},t.prototype.onConnectHandler=function(){var e=this;Log.trace("服务器连接成功"),e._reconnectCount=0,e._isConnecting=!0,this._connectFlag&&this._needReconnect?App.MessageCenter.dispatch(SocketConsts.SOCKET_RECONNECT):App.MessageCenter.dispatch(SocketConsts.SOCKET_CONNECT),this._connectFlag=!0},t.prototype.onReceiveMessage=function(){var e=this;if(!e._socket.connected)return void e.close();var t=new egret.ByteArray;e._socket.readBytes(t);var n=t.length;if(n>0){var r=t;e._readBuffer.writeBytes(r,0,n),e._writeOffset+=n,e._writeOffset>1&&(e._readOffset=0,n>=PackageIn.HEADER_SIZE&&e.readPackage())}},t.prototype.readPackage=function(){var e=this,t=e._writeOffset-e._readOffset,n=e.copyByteArray(e._readBuffer);n.position=0;do{var r=0;for(e._readBuffer.position=e._readOffset;e._readOffset+4<e._writeOffset;){if(e._headerTemp.clear(),e._headerTemp.writeByte(e._readBuffer.readByte()),e._headerTemp.writeByte(e._readBuffer.readByte()),e._headerTemp.writeByte(e._readBuffer.readByte()),e._headerTemp.writeByte(e._readBuffer.readByte()),e._encrypted&&(e._headerTemp=e.decrptBytes(e._headerTemp,4,e.copyByteArray(e.RECEIVE_KEY))),e._headerTemp.position=0,e._headerTemp.readShort()==PackageOut.HEADER){r=e._headerTemp.readUnsignedShort();break}e._readOffset++}if(t=e._writeOffset-e._readOffset,!(t>=r&&0!=r))break;var o=new egret.ByteArray;e._readBuffer.position=e._readOffset;var i=0;for(i=0;t>i;i++)o.writeByte(n.readByte());var a=new PackageIn;e._encrypted?a.loadE(o,r,e.RECEIVE_KEY):a.load(o,r),e._readOffset+=r,t=e._writeOffset-e._readOffset,e.handlePackage(a)}while(t>=PackageIn.HEADER_SIZE);e._readBuffer.position=0,t>0&&e._readBuffer.writeBytes(e._readBuffer,e._readOffset,t),e._readOffset=0,e._writeOffset=t},t.prototype.handlePackage=function(e){var t=this;e.checksum==e.calculateCheckSum()&&(e.position=PackageIn.HEADER_SIZE,t._m_PackageQueue.push(e),t.onGetSocketData())},t.prototype.decrptBytes=function(e,t,n){var r=this,o=0,i=new egret.ByteArray;e.position=0,n.position=0;var a,s,l,c,p,u=new egret.ByteArray,h=new egret.ByteArray;for(o=0;t>o;o++)o>0?(c=o%8,n.position=c,o>=8?(u.position>=8&&h.length>0&&(u.clear(),u=r.copyByteArray(h),h.clear()),u.position=c,l=u.readByte(),l=l+s^o):(l=n.readByte(),l=l+s^o,u.writeByte(l)),a=e.readByte(),p=a-s^l,i.writeByte(p),s=a):(a=e.readByte(),l=n.readByte(),p=a^l,i.writeByte(p),u.writeByte(l),s=a);return i},t.prototype.copyByteArray=function(e){var t=new egret.ByteArray;e.position=0;for(var n=0;n<e.length;n++)t.writeByte(e.readByte());return t},t.prototype.onGetSocketData=function(){var e=this;if(e._m_PackageQueue.length>0)for(var t=0;t<SocketConsts.HANDLER_MAX;){if(e._m_PackageQueue.length<=0)return;t++;var n=e._m_PackageQueue.shift();App.MessageCenter.dispatch(SocketConsts.SOCKET_DATA,n)}},t.prototype.reconnect=function(){this.closeCurrentSocket(),this._reconnectCount++,this._reconnectCount<this._maxReconnectCount?this.connect():(this._reconnectCount=0,this._connectFlag?App.MessageCenter.dispatch(SocketConsts.SOCKET_CLOSE):App.MessageCenter.dispatch(SocketConsts.SOCKET_NOCONNECT))
},t.prototype.close=function(){var e=this;e._connectFlag=!1,this.closeCurrentSocket()},t.prototype.closeCurrentSocket=function(){var e=this;e.removeEvents(),e._socket.close(),e._socket=null,e._isConnecting=!1},t.prototype.isConnecting=function(){return this._isConnecting},t}(egret.EventDispatcher);__reflect(ByteSocket.prototype,"ByteSocket");var GameSocketOut=function(){function e(){}return e.prototype.sendServerLogin=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");var n=new PackageOut;n.init(PackageOutTypeConsts.LOGIN);var r=new protocol.CommonMsg;r.strPar1=t,r.strPar2=e;var o=protocol.CommonMsg.encode(r).finish();App.SocketManager.socket.sendProtobuffer(n,o)},e}();__reflect(GameSocketOut.prototype,"GameSocketOut");var PackageIn=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,"checksum",{get:function(){return this._checksum},set:function(e){this._checksum=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientId",{set:function(e){this._clientId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this._cmdID},set:function(e){this._cmdID=e},enumerable:!0,configurable:!0}),t.prototype.loadE=function(e,t,n){var r=this,o=0,i=new egret.ByteArray,a=new egret.ByteArray;for(e.position=0,o=0;t>o;o++)i.writeByte(e.readByte());i.position=0,n.position=0;var s,l,c,p,u,h=new egret.ByteArray,g=new egret.ByteArray;for(o=0;t>o;o++)o>0?(p=o%8,n.position=p,o>=8?(h.position>=8&&g.length>0&&(h.clear(),h=r.copyByteArray(g),g.clear()),h.position=p,c=h.readByte(),c=c+l^o,g.writeByte(c)):(c=n.readByte(),c=c+l^o,h.writeByte(c)),s=i.readByte(),u=s-l^c,a.writeByte(u),l=s):(s=i.readByte(),c=n.readByte(),u=s^c,a.writeByte(u),h.writeByte(c),l=s);var f=new egret.ByteArray;for(g.length>0&&(f=r.copyByteArray(g)),h.position=g.position,o=h.position;o<h.length;o++)f.writeByte(h.readByte());for(App.SocketManager.socket.RECEIVE_KEY.clear(),App.SocketManager.socket.RECEIVE_KEY=r.copyByteArray(f),f.clear(),h.clear(),g.clear(),a.position=0,r.position=0,o=0;t>o;o++)r.writeByte(a.readByte());r.readHeader()},t.prototype.load=function(e,t){var n=this;e.position=0;for(var r=0;t>r;r++)n.writeByte(e.readByte());n.readHeader()},t.prototype.readHeader=function(){var e=this;e.position=0,e.readShort(),e._length=e.readShort(),e._checksum=e.readShort(),e._cmdID=e.readShort()},t.prototype.readBody=function(){var e=this,n=e,r=(n.length-t.HEADER_SIZE,new egret.ByteArray);n.position=t.HEADER_SIZE;for(var o=t.HEADER_SIZE;o<n.length;o++)r.writeByte(n.readByte());return r},t.prototype.calculateCheckSum=function(){var e=this,t=119,n=6;for(e.position=6;n<e.length;){n++;var r=e.readByte(),o=255&r;t+=o}var i=32639&t;return i},t.prototype.copyByteArray=function(e){e.position=0;for(var t=new egret.ByteArray,n=0;n<e.length;n++)t.writeByte(e.readByte());return t},t.HEADER_SIZE=8,t}(egret.ByteArray);__reflect(PackageIn.prototype,"PackageIn");var PackageOut=function(e){function t(n){var r=e.call(this,n)||this,o=r;return o.writeShort(t.HEADER),o.writeShort(0),o.writeShort(0),o.writeShort(0),o._checksum=0,r}return __extends(t,e),t.prototype.init=function(e){var t=this;t._cmdID=e,t.position=6,t.writeShort(t._cmdID)},t.prototype.pack=function(){var e=this;e._checksum=e.calculateCheckSum();var t=new egret.ByteArray;t.writeShort(e.length),t.writeShort(e._checksum),e.position=2,t.position=0,e.writeByte(t.readByte()),e.writeByte(t.readByte()),e.writeByte(t.readByte()),e.writeByte(t.readByte())},Object.defineProperty(t.prototype,"cmdID",{get:function(){return this._cmdID},enumerable:!0,configurable:!0}),t.prototype.calculateCheckSum=function(){var e=this,t=119,n=6;for(e.position=6;n<e.length;){n++;var r=e.readByte(),o=255&r;t+=o}return 32639&t},t.HEADER=29099,t}(egret.ByteArray);__reflect(PackageOut.prototype,"PackageOut");var SocketManager=function(e){function t(){var t=e.call(this)||this;return t._hasInitEvents=!1,t}return __extends(t,e),t.prototype.setup=function(){var e=this;e._socket=new ByteSocket(!1),e._socket.connect(),e._out=new GameSocketOut,e.initEvents()},t.prototype.initEvents=function(){var e=this;e._hasInitEvents||(App.MessageCenter.addListener(SocketConsts.SOCKET_DATA,e.onSocketDataHandler,e),e._hasInitEvents=!0)},t.prototype.removeEvents=function(){var e=this;e._hasInitEvents=!1,App.MessageCenter.removeListener(SocketConsts.SOCKET_DATA,e.onSocketDataHandler,e)},t.prototype.onSocketDataHandler=function(e){var t=e.data;if(null!=t){var n=t.code,r=t.readBody();App.MessageCenter.dispatch(SocketConsts.format(n),r.bytes)}},Object.defineProperty(t.prototype,"socket",{get:function(){var e=this;return e._socket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"out",{get:function(){var e=this;return e._out},enumerable:!0,configurable:!0}),t}(BaseClass);__reflect(SocketManager.prototype,"SocketManager");var PackageInTypeConsts=function(){function e(){}return e.LOGIN=1,e}();__reflect(PackageInTypeConsts.prototype,"PackageInTypeConsts");var PackageOutTypeConsts=function(){function e(){}return e.LOGIN=1,e}();__reflect(PackageOutTypeConsts.prototype,"PackageOutTypeConsts");var SocketConsts=function(){function e(){}return e.format=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0;r<e.length;r++)n.push(e[r].toString(16));return n.join("+")},e.SOCKET_CONNECT="SOCKET_CONNECT",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_NOCONNECT="SOCKET_NOCONNECT",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e.IP="",e.HANDLER_MAX=50,e.KEY=[174,191,86,120,171,205,239,241],e}();__reflect(SocketConsts.prototype,"SocketConsts");var BattleScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.onEnter.call(this),App.ControllerManager.applyFunc(ControllerConst.Battle,BattleConst.BATTLE_INIT)},t.prototype.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);__reflect(BattleScene.prototype,"BattleScene");var HallScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),App.ViewManager.open(ViewConst.Hall)},t.prototype.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);__reflect(HallScene.prototype,"HallScene");var LoadingScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),App.ViewManager.open(ViewConst.Loading)},t.prototype.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);__reflect(LoadingScene.prototype,"LoadingScene");var LoginScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onEnter=function(){e.prototype.onEnter.call(this),App.ViewManager.open(ViewConst.Login)},t.prototype.onExit=function(){e.prototype.onExit.call(this)},t}(BaseScene);__reflect(LoginScene.prototype,"LoginScene");var SceneManager=function(e){function t(){var t=e.call(this)||this;return t._scenes=new TSDictionary,t}return __extends(t,e),t.prototype.clear=function(){var e=this._scenes.TryGetValue(this._currScene);e&&(e.onExit(),this._currScene=void 0),this._scenes.Remove(this._currScene)},t.prototype.register=function(e,t){this._scenes.Add(e,t)},t.prototype.runScene=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this._scenes.TryGetValue(e);return null==r?void Log.trace("场景"+e+"不存在"):(r.onEnter.apply(r,t),void(this._currScene=e))},t.prototype.getCurrScene=function(){return this._currScene},t}(BaseClass);__reflect(SceneManager.prototype,"SceneManager");var BaseEuiLayer=function(e){function t(){var t=e.call(this)||this;return t.percentWidth=100,t.percentHeight=100,t.touchEnabled=!1,t}return __extends(t,e),t}(eui.Group);__reflect(BaseEuiLayer.prototype,"BaseEuiLayer");var BoneAnimation=function(e){function t(n){var r=e.call(this)||this;return r._isLoadComplete=!1,r._isInPool=!1,r._timeScale=1,r._currentAnimationName="",r._isPauseAtLastFrame=!1,r._removeAtLastFrame=!0,r._removeWhenRemoveFromStage=!0,r._playTimes=1,r._detectFrameEvent=!1,r._direction=1,r._startframeIndex=0,r._param="",r._skeName=n,r._skeName==t.traceID&&Log.trace("LoadBone constructor {0}",t.traceID),r}return __extends(t,e),t.prototype.play=function(e,n){void 0===e&&(e=null),void 0===n&&(n=null),this._skeName==t.traceID&&Log.trace("LoadBone play {0}",t.traceID),this._complete=e,this._completeTarget=n,this.addEventListener(t.LOAD_COMPLETE,this.playNow,this),this._isLoadComplete&&this.playNow()},t.prototype.stop=function(e){null!=this.armature&&this.armature.animation.stop(e)},t.prototype.playNow=function(){this._skeName==t.traceID&&Log.trace("LoadBone playNow {0}",t.traceID),this._isInPool&&Log.trace("{0} current is in pool must be not play",this._skeName),this.removeEventListener(t.LOAD_COMPLETE,this.playNow,this),""==this._currentAnimationName&&(this._currentAnimationName=this.getRandomAnimationName()),dragonBones.WorldClock.clock.add(this.armature),this.armature.animation.gotoAndPlayByFrame(this._currentAnimationName,this._startframeIndex,this.playTimes),this.armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.playComplete,this),this.detectFrameEvent&&this.armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this.onFrameEventFired,this),this.removeWhenRemoveFromStage&&this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onBoneRemove,this)},t.prototype.load=function(){this._skeName==t.traceID&&Log.trace("LoadBone load start {0}",t.traceID),App.ResUtil.loadGroup(this._skeName,this.loadComplete,this,ResUtil.PRIORITY_H)},t.prototype.onFrameEventFired=function(e){this.dispatchEvent(new egret.Event(t.FRAME_EVENT,!0,!0,e.data))},t.prototype.loadComplete=function(){this._skeName==t.traceID&&Log.trace("LoadBone loadComplete start {0}",t.traceID),this.armature=App.BoneManager.getArmature(this._skeName),this._isLoadComplete=!0,this.addChild(this.armature.display),this.initBone(),this.dispatchEvent(new egret.Event(t.LOAD_COMPLETE,!0,!0,this)),this._skeName==t.traceID&&Log.trace("LoadBone loadComplete createComplete {0}",t.traceID)},t.prototype.resetForPool=function(){this._skeName==t.traceID&&Log.trace("LoadBone resetForPool {0}",t.traceID),this._isInPool=!0,this._isLoadComplete&&(this.armature.animation.stop(),this.armature.animation.timeScale=this._timeScale=1,this.armature.display.scaleX=this._direction=1,dragonBones.WorldClock.clock.remove(this.armature),App.DisplayUtils.resetDisplay(this),App.DisplayUtils.resetDisplay(this.armature.display))},t.prototype.playComplete=function(){this._skeName==t.traceID&&Log.trace("LoadBone playComplete {0}",t.traceID),this.armature.eventDispatcher.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.playComplete,this),this.isPauseAtLastFrame&&this.armature.animation.stop(this._currentAnimationName),this.removeAtLastFrame&&this.onBoneRemove(),null!=this._complete&&null!=this._completeTarget&&this._complete.call(this._completeTarget),this.dispatchEvent(new egret.Event(t.LOOP_COMPLETE,!0,!0,this))},t.prototype.onBoneRemove=function(){this._skeName==t.traceID&&Log.trace("LoadBone onBoneRemove {0}",t.traceID),this.armature.eventDispatcher.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.playComplete,this),this.armature.eventDispatcher.removeDBEventListener(dragonBones.EventObject.FRAME_EVENT,this.onFrameEventFired,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onBoneRemove,this),ResourcePool.Instance.hasItem(this,ResourcePool.SKE)||ResourcePool.Instance.push(this,ResourcePool.SKE)},t.prototype.initBone=function(){this._skeName==t.traceID&&Log.trace("LoadBone initBone {0}",t.traceID),this._isInPool=!1,this._isLoadComplete&&(this.armature.animation.timeScale=this._timeScale),this._isLoadComplete&&(this.armature.display.scaleX=this._direction),this._positionString&&(this.position=this.position)},t.prototype.gotoAndStopFrame=function(e){void 0===e&&(e=""),this._skeName==t.traceID&&Log.trace("LoadBone playNow {0}",t.traceID),this._currentAnimationName=e,""==this._currentAnimationName&&(this._currentAnimationName=this.getRandomAnimationName()),this.armature.animation.gotoAndStopByFrame(this._currentAnimationName)},t.prototype.gotoAndStopFrameExcept=function(e){this._skeName==t.traceID&&Log.trace("LoadBone playNow {0}",t.traceID),this._currentAnimationName=this.getRandomAnimationNameExcept(e),this.armature.animation.gotoAndStopByFrame(this._currentAnimationName)},Object.defineProperty(t.prototype,"skeName",{get:function(){return this._skeName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoadComplete",{get:function(){return this._isLoadComplete},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeScale",{get:function(){return this._timeScale},set:function(e){this._timeScale=e,this._isLoadComplete&&(this.armature.animation.timeScale=this._timeScale)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAnimationName",{get:function(){return this._currentAnimationName},set:function(e){this._currentAnimationName=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playTimes",{get:function(){return this._playTimes},set:function(e){this._playTimes=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"detectFrameEvent",{get:function(){return this._detectFrameEvent},set:function(e){this._detectFrameEvent=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"removeAtLastFrame",{get:function(){return this._removeAtLastFrame},set:function(e){this._removeAtLastFrame=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPauseAtLastFrame",{get:function(){return this._isPauseAtLastFrame},set:function(e){this._isPauseAtLastFrame=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"removeWhenRemoveFromStage",{get:function(){return this._removeWhenRemoveFromStage},set:function(e){this._removeWhenRemoveFromStage=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._direction=e,this._isLoadComplete&&(this.armature.display.scaleX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionString",{get:function(){return this._positionString},set:function(e){if(""!=e){var t=e.split("|");if(2==t.length){this._positionString=e;var n=new egret.Point(Number(t[0]),Number(t[1]));this.position=n}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this.x=this._position.x,this.y=this._position.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startframeIndex",{get:function(){return this._startframeIndex},set:function(e){this._startframeIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"param",{get:function(){return this._param},set:function(e){this._param=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"param1",{get:function(){return this._param1},set:function(e){this._param1=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allAnimationNames",{get:function(){return this.armature.animation.animationNames},enumerable:!0,configurable:!0}),t.prototype.hasAnimation=function(e){return null==this.armature?!1:this.armature.animation.hasAnimation(e)},t.prototype.getFrameCountByName=function(e){var t=this.armature.animation.animations[e];return t.frameCount},t.prototype.getRandomAnimationName=function(){return 1==this.allAnimationNames.length?this.allAnimationNames[0]:ObjectUtils.getRandomItem(this.allAnimationNames)},t.prototype.getRandomAnimationNameExcept=function(e){if(1==this.allAnimationNames.length)return this.allAnimationNames[0];var t=this.allAnimationNames.slice(1);return ObjectUtils.getRandomItem(t)},t.prototype.dispose=function(){this._skeName==t.traceID&&Log.trace("LoadBone dispose {0}",t.traceID),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onBoneRemove,this),this.armature&&(this.armature.eventDispatcher.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.playComplete,this),this.armature.eventDispatcher.removeDBEventListener(dragonBones.EventObject.FRAME_EVENT,this.onFrameEventFired,this),dragonBones.WorldClock.clock.remove(this.armature),this.armature.dispose(),this.armature=null),this._skeName=null,this._complete=null,this._completeTarget=null,this._position=null,this._currentAnimationName=null,this._isPauseAtLastFrame=null,this._removeAtLastFrame=null},t.LOAD_COMPLETE="boneLoadComplete",t.LOOP_COMPLETE="boneLoopComplete",t.FRAME_EVENT="frameEvent",t.traceID="tx_01",t}(egret.Sprite);__reflect(BoneAnimation.prototype,"BoneAnimation");var BaseSpriteLayer=function(e){function t(){var t=e.call(this)||this;return t.touchEnabled=!1,t}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(BaseSpriteLayer.prototype,"BaseSpriteLayer");var BoneConfig=function(){function e(){}return e.copyValueFromTemplate=function(e,t){var n=GlobleVOData.getDataByFilter(GlobleVOData.BoneAnimationVO,"skename",t);if(n.length>0){var r=n[0];ObjectUtils.copyValue(e,r)}},e.SKE_END_TAG="_ske_json",e.TEXTUREDATA_END_TAG="_tex_json",e.TEXTURE_END_TAG="_tex_png",e}();__reflect(BoneConfig.prototype,"BoneConfig");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.createView,t),t}return __extends(t,e),t.prototype.createView=function(){var e=this;e.width=e.stage.stageWidth,e.height=e.stage.stageHeight,this.Bg=new egret.Bitmap,this.Bg.texture=RES.getRes("loadingBg_jpg"),this.Bg.width=this.width,this.Bg.height=this.height,this.addChild(this.Bg),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=20,this.textField.y=this.height/2-this.textField.height/2,this.textField.size=20,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField&&(this.textField.text="Loading..."+e+"/"+t)},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SoundEffects=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(e){var t=this.getSound(e);t&&this.playSound(t)},t.prototype.playSound=function(e){var t=e.play(0,1);t.volume=this._volume},t.prototype.setVolume=function(e){this._volume=e},t.prototype.loadedPlay=function(e){this.playSound(RES.getRes(e))},t}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var SoundManager=function(e){function t(){var t=e.call(this)||this;return t.bgOn=!0,t.effectOn=!0,t.bgVolume=.5,t.effectVolume=.5,t.bg=new SoundBG,t.bg.setVolume(t.bgVolume),t.effect=new SoundEffects,t.effect.setVolume(t.effectVolume),t}return __extends(t,e),t.prototype.playEffect=function(e){this.effectOn&&this.effect.play(e)},t.prototype.playBg=function(e){this.currBg=e,this.bgOn&&this.bg.play(e)},t.prototype.stopBg=function(){this.bg.stop()},t.prototype.setEffectOn=function(e){this.effectOn=e},t.prototype.setBgOn=function(e){this.bgOn=e,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},t.prototype.setBgVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.bgVolume=e,this.bg.setVolume(this.bgVolume)},t.prototype.getBgVolume=function(){return this.bgVolume},t.prototype.setEffectVolume=function(e){e=Math.min(e,1),e=Math.max(e,0),this.effectVolume=e,this.effect.setVolume(this.effectVolume)},t.prototype.getEffectVolume=function(){return this.effectVolume},t.CLEAR_TIME=18e4,t}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var starlingswf;!function(e){var t=function(){function t(n,r,o){void 0===o&&(o=24),this._swfData=n,this._assetManager=r,this._createDisplayFuns=new Object,this._createDisplayFuns[t.dataKey_Sprite]=this.createSprite,this._createDisplayFuns[t.dataKey_MovieClip]=this.createMovie,this._createDisplayFuns[t.dataKey_Image]=this.createImage,this._createDisplayFuns[t.dataKey_Scale9]=this.createS9Image,this._createDisplayFuns[t.dataKey_ShapeImg]=this.createShapeImage,this._createDisplayFuns[t.dataKey_TextField]=this.createTextField,this.swfUpdateManager=e.SwfUpdateManager.createSwfUpdateManager(o)}return t.prototype.createSprite=function(n,r,o){void 0===r&&(r=null),void 0===o&&(o=null),null==o&&(o=this._swfData[t.dataKey_Sprite][n]);for(var i,a,s,l=new e.SwfSprite,c=o.length,p=0;c>p;p++)i=o[p],s=this._createDisplayFuns[i[1]],null!=s&&(a=s.apply(this,[i[0],i]),a.name=i[9],a.x=i[2],a.y=i[3],i[0]==t.dataKey_TextField,i[1]!=t.dataKey_Scale9&&i[1]!=t.dataKey_ShapeImg&&(a.scaleX=i[4],a.scaleY=i[5]),a.skewX=i[6],a.skewY=i[7],a.alpha=i[8],l.addChild(a));return l},t.prototype.createMovie=function(n,r,o){void 0===r&&(r=null),void 0===o&&(o=null);var i,a,s,l,c,p=this._swfData[t.dataKey_MovieClip][n],u=p.objCount,h={};for(c in u){a=u[c][0],s=u[c][1],i=null==h[c]?[]:h[c];for(var g=0;s>g;g++)l=this._createDisplayFuns[a],null!=l&&i.push(l.apply(this,[c,null]));h[c]=i}var f;return f=null==o?new e.SwfMovieClip(p.frames,p.labels,h,this):new o(p.frames,p.labels,h,this),f.loop=p.loop,f},t.prototype.createImage=function(e,n){void 0===n&&(n=null);var r=this._swfData[t.dataKey_Image][e],o=this._assetManager.createBitmap(e);return o.anchorOffsetX=r[0],o.anchorOffsetY=r[1],o},t.prototype.getTexture=function(e){return this._assetManager.getTexture(e)},t.prototype.createS9Image=function(e,n){void 0===n&&(n=null);var r=this._swfData[t.dataKey_Scale9][e],o=this._assetManager.createBitmap(e);return o.scale9Grid=new egret.Rectangle(r[0],r[1],r[2],r[3]),null!=n&&(o.width=n[10],o.height=n[11]),o},t.prototype.createShapeImage=function(e,t){void 0===t&&(t=null);var n=this._assetManager.createBitmap(e);return n.fillMode=egret.BitmapFillMode.REPEAT,null!=t&&(n.width=t[10],n.height=t[11]),n},t.prototype.createTextField=function(e,t){void 0===t&&(t=null);var n=new egret.TextField;return null!=t&&(n.width=t[10],n.height=t[11],n.textColor=t[13],n.size=t[14],n.textAlign=t[15],n.text=t[18]),n},t.prototype.hasSprite=function(e){return null!=this._swfData[t.dataKey_Sprite][e]},t.prototype.hasMovieClip=function(e){return null!=this._swfData[t.dataKey_MovieClip][e]},t.prototype.hasImage=function(e){return null!=this._swfData[t.dataKey_Image][e]},t.prototype.hasS9Image=function(e){return null!=this._swfData[t.dataKey_Scale9][e]},t.prototype.hasShapeImage=function(e){return null!=this._swfData[t.dataKey_ShapeImg][e]},t.dataKey_Sprite="spr",t.dataKey_Image="img",t.dataKey_MovieClip="mc",t.dataKey_TextField="text",t.dataKey_Button="btn",t.dataKey_Scale9="s9",t.dataKey_ShapeImg="shapeImg",t.dataKey_Component="comp",t.dataKey_Particle="particle",t}();e.Swf=t,__reflect(t.prototype,"starlingswf.Swf")}(starlingswf||(starlingswf={}));var starlingswf;!function(e){var t=function(){function e(){this._sheets={},this._textures={}}return e.prototype.addSpriteSheet=function(e,t){this._sheets[e]=t},e.prototype.addTexture=function(e,t){this._textures[e]=t},e.prototype.createBitmap=function(e){var t=this.getTexture(e);if(null==t)return null;var n=new egret.Bitmap;return n.texture=t,n},e.prototype.getTexture=function(e){var t,n,r;for(r in this._sheets)if(n=this._sheets[r],t=n.getTexture(e),null!=t)break;return null==t&&(t=this._textures[e]),t},e}();e.SwfAssetManager=t,__reflect(t.prototype,"starlingswf.SwfAssetManager")}(starlingswf||(starlingswf={}));var starlingswf;!function(e){var t=function(){function e(){}return e.createSwfUpdateManager=function(t){var n=new e;return n._animations=[],n._addQueue=[],n._removeQueue=[],n._currentTime=0,n.setFps(t),App.TimerManager.doFrame(1,0,n.update,n),n},e.prototype.clear=function(){this._addQueue.splice(0),this._removeQueue.splice(0),this._animations.splice(0)},e.prototype.stop=function(){this.clear(),App.TimerManager.remove(this.update,this)},e.prototype.play=function(){App.TimerManager.doFrame(1,0,this.update,this)},e.prototype.setFps=function(e){this._fps=e,this._fpsTime=1e3/e},e.prototype.addSwfAnimation=function(e){this._addQueue.push(e)},e.prototype.removeSwfAnimation=function(e){this._removeQueue.push(e);var t=this._addQueue.indexOf(e);-1!=t&&this._addQueue.splice(t,1)},e.prototype.updateAdd=function(){for(var e,t,n=this._addQueue.length,r=0;n>r;r++)t=this._addQueue.pop(),e=this._animations.indexOf(t),-1==e&&this._animations.push(t)},e.prototype.updateRemove=function(){for(var e,t,n=this._removeQueue.length,r=0;n>r;r++)t=this._removeQueue.pop(),e=this._animations.indexOf(t),-1!=e&&this._animations.splice(e,1)},e.prototype.update=function(e){if(this._currentTime+=e,!(this._currentTime<this._fpsTime)){this._currentTime-=this._fpsTime,this._update();for(var t=0;this._currentTime>this._fpsTime;)this._currentTime-=this._fpsTime,t++,4>t&&this._update()}},e.prototype._update=function(){this.updateRemove(),this.updateAdd();for(var e=this._animations.length,t=0;e>t;t++)this._animations[t].update()},e}();e.SwfUpdateManager=t,__reflect(t.prototype,"starlingswf.SwfUpdateManager")}(starlingswf||(starlingswf={}));var BoneManager=function(e){function t(){var t=e.call(this)||this;return t._factory=dragonBones.EgretFactory.factory,t}return __extends(t,e),t.prototype.test_showBone=function(e){var t=ResourcePool.Instance.pop(e,ResourcePool.SKE);t.playTimes=0,t.removeAtLastFrame=!1,t.play()},t.prototype.start=function(){App.StageUtils.getStage().addEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},t.prototype.stop=function(){App.StageUtils.getStage().removeEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},t.prototype.onUpdate=function(e){dragonBones.WorldClock.clock.advanceTime(-1)},t.prototype.getArmature=function(e){if(null==this._factory.getDragonBonesData(e)){var t=this.getSkeData(e),n=this.getTextureData(e),r=this.getTexture(e);this._factory.parseDragonBonesData(t),this._factory.parseTextureAtlasData(n,r)}var o=this._factory.buildArmature(e);return o},t.prototype.getSkeData=function(e){return RES.getRes(e+BoneConfig.SKE_END_TAG)},t.prototype.getTextureData=function(e){return RES.getRes(e+BoneConfig.TEXTUREDATA_END_TAG)},t.prototype.getTexture=function(e){return RES.getRes(e+BoneConfig.TEXTURE_END_TAG)},t}(BaseClass);__reflect(BoneManager.prototype,"BoneManager");var ControllerConst;!function(e){e[e.Loading=1e4]="Loading",e[e.Login=10001]="Login",e[e.Hall=10002]="Hall",e[e.Friend=10003]="Friend",e[e.Shop=10004]="Shop",e[e.Warehouse=10005]="Warehouse",e[e.Factory=10006]="Factory",e[e.Task=10007]="Task",e[e.Battle=10008]="Battle",e[e.Level=10009]="Level"}(ControllerConst||(ControllerConst={}));var StarlingSwfFactory=function(e){function t(){var t=e.call(this)||this;return t.swfAssetsManager=new starlingswf.SwfAssetManager,t.swfAssetsNames=new Array,t.swfAssets=new Array,t.swfData={},t}return __extends(t,e),t.prototype.addSwf=function(e,t,n){if(-1==this.swfAssetsNames.indexOf(e)){if(null==t||null==n)return void Log.trace("SWF加载失败:"+e);this.swfAssetsManager.addSpriteSheet(e,n);var r=new starlingswf.Swf(t,this.swfAssetsManager,24);r.name=e,StarlingSwfUtils.addSwf(r),this.swfAssetsNames.push(e),this.swfAssets.push(r)}},t.prototype.stopSwfs=function(e){for(var t=0,n=e.length;n>t;t++){var r=StarlingSwfUtils.getSwf(e[t]);r&&r.swfUpdateManager.stop()}},t.prototype.playSwfs=function(e){for(var t=0,n=e.length;n>t;t++){var r=StarlingSwfUtils.getSwf(e[t]);r&&r.swfUpdateManager.play()}},t.prototype.clearSwfs=function(){for(;this.swfAssets.length;)StarlingSwfUtils.removeSwf(this.swfAssets.pop());for(;this.swfAssetsNames.length;)this.swfAssetsNames.pop();this.swfAssetsManager=new starlingswf.SwfAssetManager},t.prototype.clear=function(){this.clearSwfs()},t.prototype.makeMc=function(e){var t=StarlingSwfUtils.createMovie("mc_"+e,null,StarlingSwfMovieClip);return null==t&&Log.trace("SWF创建失败: "+e),t},t.prototype.makeImage=function(e){return StarlingSwfUtils.createImage("img_"+e)},t.prototype.getTexture=function(e){return StarlingSwfUtils.getTexture("img_"+e)},t}(BaseClass);__reflect(StarlingSwfFactory.prototype,"StarlingSwfFactory");var StarlingSwfMovieClip=function(e){function t(t,n,r,o){var i=e.call(this,t,n,r,o)||this;return i.frameActions={},i.preFrame=-1,i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemove,i),i}return __extends(t,e),t.prototype.onRemove=function(){this.stop()},t.prototype.setFrameAction=function(e,t,n,r){void 0===r&&(r=null),this.frameActions[e]=[t,n,r]},t.prototype.setCompleteAction=function(e,t){this.complateFunc=e,this.complateObj=t,this.addEventListener(egret.Event.COMPLETE,this.onPlayend,this)},t.prototype.onPlayend=function(){this.complateFunc&&this.complateFunc.call(this.complateObj)},t.prototype.goToPlay=function(e){this.preFrame=-1,this.currFrameName=e,this.gotoAndPlay(e)},t.prototype.setCurrentFrame=function(t){e.prototype.setCurrentFrame.call(this,t);var n=this.getCurrentFrame();if(this.preFrame!=n&&(this.preFrame=n,this.frameActions&&this.frameActions[n])){var r=this.frameActions[n];r[2]?r[0].call(r[1],r[2]):r[0].call(r[1])}},t.prototype.dispose=function(){this.stop(),this.removeEventListener(egret.Event.COMPLETE,this.onPlayend,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),App.DisplayUtils.removeFromParent(this),this.complateFunc=null,this.complateObj=null,this.frameActions=null},t}(starlingswf.SwfMovieClip);__reflect(StarlingSwfMovieClip.prototype,"StarlingSwfMovieClip");var StarlingSwfUtils=function(){function e(){}return e.addSwf=function(t){e.swfList.push(t)},e.removeSwf=function(t){var n=e.swfList.indexOf(t);-1!=n&&e.swfList.splice(n,1)},e.createSprite=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);for(var o=e.swfList.length,i=0;o>i;i++){var a=e.swfList[i];if(a.hasSprite(t))return a.createSprite(t,n,r)}return null},e.createImage=function(t,n){void 0===n&&(n=null);for(var r=e.swfList.length,o=0;r>o;o++){var i=e.swfList[o];if(i.hasImage(t))return i.createImage(t,n)}return null},e.getTexture=function(t){for(var n=e.swfList.length,r=0;n>r;r++){var o=e.swfList[r];if(o.hasImage(t))return o.getTexture(t)}return null},e.createMovie=function(t,n,r){void 0===n&&(n=null),void 0===r&&(r=null);for(var o=e.swfList.length,i=0;o>i;i++){var a=e.swfList[i];if(a.hasMovieClip(t))return a.createMovie(t,n,r)}return null},e.createS9Image=function(t,n){void 0===n&&(n=null);for(var r=e.swfList.length,o=0;r>o;o++){var i=e.swfList[o];if(i.hasS9Image(t))return i.createS9Image(t,n)}return null},e.createShapeImage=function(t,n){void 0===n&&(n=null);for(var r=e.swfList.length,o=0;r>o;o++){var i=e.swfList[o];if(i.hasShapeImage(t))return i.createShapeImage(t,n)}return null},e.getSwf=function(t){for(var n=e.swfList.length,r=0;n>r;r++){var o=e.swfList[r];if(o.name==t)return o}return null},e.fixButton=function(t,n,r){e.firstAddBtn&&(e.firstAddBtn=!1,egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),egret.MainContext.instance.stage.addEventListener(egret.Event.LEAVE_STAGE,this.onTouchEnd,this));var o=new StarlingSwfButtonData;o.btn=t,o.onClick=n,o.thisObj=r,e.btnList.push(o),t.touchEnabled=!0,t.gotoAndStop(0),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnTouchBegin,t)},e.onBtnTouchBegin=function(t){for(var n=t.currentTarget,r=e.btnList.length,o=0;r>o;o++){var i=e.btnList[o];if(i.btn==n){i.touchStageX=t.stageX,i.touchStageY=t.stageY,n.gotoAndStop(1);break}}},e.onTouchEnd=function(t){for(var n=e.btnList.length,r=0;n>r;r++){var o=e.btnList[r];-1!=o.touchStageX&&(t.stageX&&Math.abs(o.touchStageX-t.stageX)<10&&Math.abs(o.touchStageY-t.stageY)<10&&o.onClick&&o.onClick.call(o.thisObj,t),o.touchStageX=-1,o.touchStageY=-1,o.btn.gotoAndStop(0))}},e.swfList=[],e.btnList=[],e.firstAddBtn=!0,e}();__reflect(StarlingSwfUtils.prototype,"StarlingSwfUtils");var StarlingSwfButtonData=function(){function e(){this.touchStageX=-1,this.touchStageY=-1}return e}();__reflect(StarlingSwfButtonData.prototype,"StarlingSwfButtonData");var AnchorUtil=function(){function e(){}return e.init=function(){e._propertyChange=Object.create(null),e._anchorChange=Object.create(null),e.injectAnchor()
},e.setAnchorX=function(e,t){e.anchorX=t},e.setAnchorY=function(e,t){e.anchorY=t},e.setAnchor=function(e,t){e.anchorX=e.anchorY=t},e.getAnchor=function(e){return e.anchorX!=e.anchorY&&Log.trace("target's anchorX != anchorY"),e.anchorX||0},e.getAnchorY=function(e){return e.anchorY||0},e.getAnchorX=function(e){return e.anchorX||0},e.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(t){var n=this;this.$setWidth(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(t){var n=this;this.$setHeight(t),e._propertyChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(t){var n=this;this._anchorX=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(t){var n=this;this._anchorY=t,e._propertyChange[this.hashCode]=!0,e._anchorChange[this.hashCode]=!0,egret.callLater(function(){e.changeAnchor(n)},this)},enumerable:!0,configurable:!0})},e.changeAnchor=function(t){e._propertyChange[t.hashCode]&&e._anchorChange[t.hashCode]&&(t._anchorX&&(t.anchorOffsetX=t._anchorX*t.width),t._anchorY&&(t.anchorOffsetY=t._anchorY*t.height),delete e._propertyChange[t.hashCode])},e}();__reflect(AnchorUtil.prototype,"AnchorUtil");var AverageUtils=function(){function e(e){void 0===e&&(e=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=e}return e.prototype.push=function(e){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(e),this.numSum+=e,this.numsLen++},e.prototype.getValue=function(){return this.numSum/this.numsLen},e.prototype.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},e}();__reflect(AverageUtils.prototype,"AverageUtils");var CommonUtils=function(e){function t(){var t=e.call(this)||this;return t._token=0,t.labelIsOverLenght=function(e,t){var n=null;n=1e5>t?t:1e6>t?Math.floor(t/1e3/10).toString()+"万":Math.floor(t/1e4).toString()+"万",e.text=n},t}return __extends(t,e),Object.defineProperty(t.prototype,"Token",{get:function(){return this._token++},enumerable:!0,configurable:!0}),t.prototype.addLableStrokeColor=function(e,t,n){e.strokeColor=t,e.stroke=n},t.prototype.lock=function(){var e=App.StageUtils.getStage();e.$children.forEach(function(e){e instanceof egret.DisplayObjectContainer&&(e.touchEnabled=e.touchChildren=!1)})},t.prototype.unlock=function(){var e=App.StageUtils.getStage();e.$children.forEach(function(e){e instanceof egret.DisplayObjectContainer&&(e.touchEnabled=e.touchChildren=!0)})},t.prototype.int64ToNumber=function(e){return parseInt(e.toString())},t.prototype.getSpeed=function(e,t,n){var r=new egret.Point,o=egret.Point.distance(e,t);return 0==o?(r.x=0,r.y=0,r):(r.x=n*(e.x-t.x)/o,r.y=n*(e.y-t.y)/o,r)},t.prototype.numPrecentage=function(e,t,n){var r=Math.floor(e/t*n);return r>n&&(r=n),r},t}(BaseClass);__reflect(CommonUtils.prototype,"CommonUtils");var CSVParser=function(){function e(){}return e.ParseJsonData=function(e,t){var n=this,r=new TSDictionary;t=t.trim();var o=JSON.parse(t),i=null,a=null,s=null,l=null;if(i=o.titles,null==o.data)return r;s=o.data,a=s[0];var c=0,p=s.length;for(c=0;p>c;c++){var u=new e;l=s[c],n.ParseRecord(i,l,u),r.Add(parseInt(l[0]),u)}return t=null,r},e.ParseRecord=function(e,t,n){for(var r=t.length,o=0;r>o;o++)n[e[o]]=t[o]},e}();__reflect(CSVParser.prototype,"CSVParser");var DebugUtils=function(e){function t(){var t=e.call(this)||this;return t._threshold=3,t._startTimes={},t}return __extends(t,e),t.prototype.isOpen=function(e){this._isOpen=e},Object.defineProperty(t.prototype,"isDebug",{get:function(){return this._isOpen},enumerable:!0,configurable:!0}),t.prototype.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},t.prototype.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold&&Log.trace(e+": "+t),t},t.prototype.setThreshold=function(e){this._threshold=e},t}(BaseClass);__reflect(DebugUtils.prototype,"DebugUtils");var DeviceUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsQQBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsIEBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFirefoxBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsChromeBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsSafariBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsOperaBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")},enumerable:!0,configurable:!0}),t}(BaseClass);__reflect(DeviceUtils.prototype,"DeviceUtils");var DisplayUtils=function(e){function t(){var t=e.call(this)||this;return t.stableFramerate=30,t.red=16516357,t.white=16777215,t.black=0,t.green=6946645,t}return __extends(t,e),t.prototype.getChildIndex=function(e){return null==e||null==e.parent?-1:e.parent.getChildIndex(e)},t.prototype.textDotAnimation=function(e){var t=e.text,n=egret.Tween.get(e,{loop:!0});n.to({},500).call(function(){e.text=t+"."}),n.to({},500).call(function(){e.text=t+".."}),n.to({},500).call(function(){e.text=t+"..."}),n.to({},500).call(function(){e.text=t}),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){egret.Tween.removeTweens(e),n=null},this)},t.prototype.getLocalPos=function(e,t,n){var r=t.localToGlobal(n.x,n.y);return e.globalToLocal(r.x,r.y)},t.prototype.safeRemoveChild=function(e){null!=e&&null!=e.parent&&e.parent.removeChild(e)},t.prototype.scaleToNormalSizeWithContainer=function(e,t){var n=this.searchContainerScale(e.parent,t);e.scaleX=1/n,e.scaleY=1/n},t.prototype.searchContainerScale=function(e,t){var n=1;return e!=t&&(n=this.searchContainerScale(e.parent,t)*n),n},t.prototype.createBitmap=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.name=e,t},t.prototype.setBoxLayout=function(e,t,n,r){var o=n.y-(e.y+e.height);o>0&&t.scaleY},t.prototype.removeFromParent=function(e){e&&(e.parent&&e.parent.removeChild(e),e=null)},t.prototype.removeAllChildren=function(e){if(e&&e&&e.numChildren)for(;e.numChildren;){var t=e.getChildAt(0);t&&(t.parent&&t.parent.removeChild(t),t=null)}},t.prototype.traceAllChildren=function(e){if(e)for(var t=0;t<e.numChildren;t++){var n=e.getChildAt(t);Log.trace("traceAllChildren : item{0} : {1}",t,egret.getQualifiedClassName(n))}},t.prototype.setText=function(e,t){if(void 0===t&&(t=""),e){var n=new egret.HtmlTextParser;e.textFlow=n.parser(t)}},t.prototype.traceDisplayObjectWhyNotDisplay=function(e){null!=e.parent&&(0==this.ifIsDisplay(e)&&Log.trace("显示出问题了"),this.traceDisplayObjectWhyNotDisplay(e.parent),Log.trace(egret.getQualifiedClassName(e)+", parent"+egret.getQualifiedClassName(e.parent)))},t.prototype.resetDisplay=function(e){null!=e&&(e.x=0,e.y=0,e.scaleX=1,e.scaleX=1)},t.prototype.ifIsDisplay=function(e){return e.visible?0==e.alpha?!1:0==e.width?!1:0==e.height?!1:null==e.parent?!1:!0:!1},t.prototype.SortDisplayBy_Y=function(e,t){e.sort(function(e,t){return t.y-e.y});for(var n=0;n<e.length;n++)t.addChildAt(e[n],0)},t.prototype.layoutDisplayWithInnerRect=function(e,t,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),null!=t){0==n&&0==r?(n=e.parent.width,r=e.parent.height):-1==n&&-1==r&&(n=App.StageUtils.getWidth(),r=App.StageUtils.getHeight());var o=t.getInnerRect(n,r);e.x=o.x,e.y=o.y,e.width=o.width,e.height=o.height}},t.prototype.addAsyncBimapToContainer=function(e,t,n){void 0===n&&(n=null),RES.getResByUrl(e,function(){var r=RES.getRes(e),o=new egret.Bitmap(r);t.addChild(o),n&&n()},this,RES.ResourceItem.TYPE_IMAGE)},t.prototype.addAsyncBitmapToImage=function(e,t,n){void 0===n&&(n=null),RES.getResByUrl(e,function(){t.source=RES.getRes(e),n&&n()},this,RES.ResourceItem.TYPE_IMAGE)},t.prototype.setFilters=function(e){if(e){var t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],n=new egret.ColorMatrixFilter(t);e.filters=[n]}},t}(BaseClass);__reflect(DisplayUtils.prototype,"DisplayUtils");var EffectUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.macIconShake=function(e,t){for(var n=[[20,300],[15,300],[10,300],[5,300]],r="egret.Tween.get("+e+")",o=0,i=n.length;i>o;o++)r+=".to({'y':"+t+"-"+n[o][0]+"}, "+n[o][1]+")",r+=".to({'y':"+t+"}, "+n[o][1]+")";return r+=";"},t.prototype.startFlicker=function(e,t){e.alpha=1,egret.Tween.get(e).to({alpha:0},t).to({alpha:1},t).call(this.startFlicker,this,[e,t])},t.prototype.stopFlicker=function(e){egret.Tween.removeTweens(e)},t.prototype.bombEffect=function(e,t){var n=ResourcePool.Instance.pop("ui_bao01",ResourcePool.SKE);App.LayerManager.addToLayer(n,LayerManager.GAME_EFFECT_LAYER),n.x=e.x,n.y=e.y,n.play(function(){App.DisplayUtils.removeFromParent(n)},t)},t.prototype.viewShowEffect=function(e,t,n){void 0===t&&(t=VIEW_SHOW_TYPE.UP),void 0===n&&(n=null);var r=null;switch(t){case VIEW_SHOW_TYPE.UP:e.anchorOffsetY=App.StageUtils.getHeight(),r={anchorOffsetY:0};break;case VIEW_SHOW_TYPE.DOWN:e.anchorOffsetY=-App.StageUtils.getHeight(),r={anchorOffsetY:0};break;case VIEW_SHOW_TYPE.RIGHT:e.anchorOffsetX=App.StageUtils.getWidth(),r={anchorOffsetX:0};break;case VIEW_SHOW_TYPE.LEFT:e.anchorOffsetX=-App.StageUtils.getWidth(),r={anchorOffsetX:0};break;default:e.anchorOffsetY=App.StageUtils.getHeight(),r={anchorOffsetY:0}}egret.Tween.get(e).to(r,300).call(function(){egret.Tween.removeTweens(e),n&&n()})},t}(BaseClass);__reflect(EffectUtils.prototype,"EffectUtils");var VIEW_SHOW_TYPE;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT"}(VIEW_SHOW_TYPE||(VIEW_SHOW_TYPE={}));var ExpandUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){AnchorUtil.init()},t}(BaseClass);__reflect(ExpandUtils.prototype,"ExpandUtils");var InnerRectangle=function(){function e(e,t,n,r,o){void 0===o&&(o=0),this.para1=e,this.para2=t,this.para3=n,this.para4=r,this.lockDirection=o}return e.prototype.equals=function(e){return null==e?!1:this.para4==e.para4&&this.para1==e.para1&&this.lockDirection==e.lockDirection&&this.para2==e.para2&&this.para3==e.para3},e.prototype.getInnerRect=function(e,t){return this._outerWidth=e,this._outerHeight=t,this.calculateCurrent()},e.prototype.calculateCurrent=function(){var e=new egret.Rectangle;return this.lockDirection==LockDirectionTypes.UNLOCK?(e.x=this.para1,e.y=this.para3,e.width=this._outerWidth-this.para1-this.para2,e.height=this._outerHeight-this.para3-this.para4):this.lockDirection==LockDirectionTypes.LOCK_T?(e.x=this.para1,e.y=this.para3,e.width=this._outerWidth-this.para1-this.para2,e.height=this.para4):this.lockDirection==LockDirectionTypes.LOCK_L?(e.x=this.para1,e.y=this.para3,e.width=this.para2,e.height=this._outerHeight-this.para3-this.para4):this.lockDirection==LockDirectionTypes.LOCK_R?(e.x=this._outerWidth-this.para1-this.para2,e.y=this.para3,e.width=this.para1,e.height=this._outerHeight-this.para3-this.para4):this.lockDirection==LockDirectionTypes.LOCK_B?(e.x=this.para1,e.y=this._outerHeight-this.para3-this.para4,e.width=this._outerWidth-this.para1-this.para2,e.height=this.para3):this.lockDirection==LockDirectionTypes.NO_SCALE_T?(e.x=(this._outerWidth-this.para1)/2+this.para4,e.y=this.para3,e.width=this.para1,e.height=this.para2):this.lockDirection==LockDirectionTypes.NO_SCALE_B?(e.x=(this._outerWidth-this.para1)/2+this.para3,e.y=this._outerHeight-this.para4-this.para2,e.width=this.para1,e.height=this.para2):this.lockDirection==LockDirectionTypes.NO_SCALE_L?(e.x=this.para1,e.y=(this._outerHeight-this.para4)/2+this.para2,e.width=this.para3,e.height=this.para4):this.lockDirection==LockDirectionTypes.NO_SCALE_R?(e.x=this._outerWidth-this.para2-this.para3,e.y=(this._outerHeight-this.para3)/2+this.para1,e.width=this.para3,e.height=this.para4):this.lockDirection==LockDirectionTypes.NO_SCALE_TL?(e.x=this.para1,e.y=this.para3,e.width=this.para2,e.height=this.para4):this.lockDirection==LockDirectionTypes.NO_SCALE_TR?(e.x=this._outerWidth-this.para1-this.para2,e.y=this.para3,e.width=this.para1,e.height=this.para4):this.lockDirection==LockDirectionTypes.NO_SCALE_BL?(e.x=this.para1,e.y=this._outerHeight-this.para4-this.para3,e.width=this.para2,e.height=this.para3):this.lockDirection==LockDirectionTypes.NO_SCALE_BR?(e.x=this._outerWidth-this.para1-this.para2,e.y=this._outerHeight-this.para4-this.para3,e.width=this.para1,e.height=this.para3):this.lockDirection==LockDirectionTypes.UNLOCK_OUTSIDE?(e.x=-this.para1,e.y=-this.para3,e.width=this._outerWidth+this.para1+this.para2,e.height=this._outerHeight+this.para4+this.para3):this.lockDirection==LockDirectionTypes.NO_SCALE_C?(e.x=(this._outerWidth-this.para2)/2+this.para1,e.y=(this._outerHeight-this.para4)/2+this.para3,e.width=this.para2,e.height=this.para4):this.lockDirection==LockDirectionTypes.LOCK_TL?(e.x=this.para1,e.y=this.para2,e.width=this._outerWidth-this.para3,e.height=this._outerHeight-this.para4):this.lockDirection==LockDirectionTypes.LOCK_OUTER_DOWN&&(e.x=this.para1,e.y=this.para2,e.width=this._outerWidth-this.para3,e.height=this.para4),e},e}();__reflect(InnerRectangle.prototype,"InnerRectangle");var KeyboardUtils=function(e){function t(){var t=e.call(this)||this;if(t.key_ups=new Array,t.key_downs=new Array,App.DeviceUtils.IsHtml5){var n=t;document.addEventListener("keyup",function(e){for(var t=0,r=n.key_ups.length;r>t;t++){var o=n.key_ups[t][0],i=n.key_ups[t][1];i?o.call(i,e.keyCode):o(e.keyCode)}}),document.addEventListener("keydown",function(e){for(var t=0,r=n.key_downs.length;r>t;t++){var o=n.key_downs[t][0],i=n.key_downs[t][1];i?o.call(i,e.keyCode):o(e.keyCode)}})}return t}return __extends(t,e),t.prototype.addKeyUp=function(e,t){this.key_ups.push([e,t])},t.prototype.addKeyDown=function(e,t){this.key_downs.push([e,t])},t.prototype.removeKeyUp=function(e,t){for(var n=0;n<this.key_ups.length;n++)this.key_ups[n][0]==e&&this.key_ups[n][1]==t&&(this.key_ups.splice(n,1),n--)},t.prototype.removeKeyDown=function(e,t){for(var n=0;n<this.key_downs.length;n++)this.key_downs[n][0]==e&&this.key_downs[n][1]==t&&(this.key_downs.splice(n,1),n--)},t}(BaseClass);__reflect(KeyboardUtils.prototype,"KeyboardUtils");var LockDirectionTypes=function(){function e(){}return e.LOCK_B=4,e.LOCK_L=2,e.LOCK_R=3,e.LOCK_T=1,e.UNLOCK=0,e.NO_SCALE_T=9,e.NO_SCALE_B=10,e.NO_SCALE_L=11,e.NO_SCALE_R=12,e.NO_SCALE_TL=13,e.NO_SCALE_TR=14,e.NO_SCALE_BL=15,e.NO_SCALE_BR=16,e.NO_SCALE_C=17,e.UNLOCK_OUTSIDE=-1,e.LOCK_TL=5,e.LOCK_TR=6,e.LOCK_OUTER_DOWN=18,e}();__reflect(LockDirectionTypes.prototype,"LockDirectionTypes");var Log=function(){function e(){}return e.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];App.DebugUtils.isDebug&&(e[0]="[DebugLog]"+e[0],console.log.apply(console,e))},e.traceError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e[0]="[ErrorLog]"+e[0],console.log.apply(console,e)},e}();__reflect(Log.prototype,"Log");var MathUtils=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Deg2Rad=.01745329,t.Rad2Deg=57.29578,t.Max=9999999,t}return __extends(t,e),t.prototype.Angle=function(e,t,n){var r=0,o=0,i=0,a=t.x-e.x,s=t.y-e.y,l=n.x-e.x,c=n.y-e.y;return r=a*l+s*c,i=(a*a+s*s)*(l*l+c*c),r/=Math.sqrt(i),r>=1?0:-1>=r?Math.PI:(o=Math.acos(r),180*o/Math.PI<180?180-180*o/Math.PI:360-180*o/Math.PI)},t.prototype.Clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},t.prototype.Approximately=function(e,t){return Math.abs(e-t)<.01},t.prototype.Range=function(e,t){var n=Math.max(e,t),r=Math.min(e,t);return Math.random()*(n-r)+r},t.prototype.moveToNextPosition=function(e,t,n){var r=this.getAngle(e,t),o=e.x+n*Math.cos(r*Math.PI/180),i=e.y-n*Math.sin(r*Math.PI/180);e.x=o,e.y=i},t.prototype.getAngle=function(e,t){var n=e.x-t.x,r=e.y-t.y,o=Math.sqrt(Math.pow(r,2)+Math.pow(n,2)),i=Math.acos(r/o),a=180/(Math.PI/i);return 0>n?a=-a:0==n&&0>r&&(a=180),-a},t.prototype.getNewAngle=function(e,t){var n=180+180*Math.atan2(e.x-t.x,e.y-t.y)/Math.PI;return n},t.prototype.randomBool=function(){return 1==Math.round(Math.random())},t.prototype.randomPointFromRect=function(e){var t=new egret.Point;return t.x=Math.random()*e[2]+e[0],t.y=Math.random()*e[3]+e[1],t},t.prototype.getRadian=function(e){return e/180*Math.PI},t.prototype.getRadian2=function(e,t,n,r){var o=n-e,i=r-t;return Math.atan2(i,o)},t.prototype.getDistance=function(e,t,n,r){var o=n-e,i=r-t,a=o*o+i*i;return Math.sqrt(a)},t.prototype.dgs2rds=function(e){return e*Math.PI/180},t.prototype.rds2dgs=function(e){return this.fixAngle(180*e/Math.PI)},t.prototype.fixAngle=function(e){return e%=360,0>e?e+360:e},t.prototype.getLineAngle=function(e,t){var n=(t.x-e.x,Math.abs(t.y-e.y)),r=egret.Point.distance(e,t),o=Math.round(Math.asin(n/r)/Math.PI*180);return e.x>t.x?e.y>t.y?o+=180:e.y<t.y?o=180-o:e.y==t.y&&(o=180):e.x<t.x?e.y>t.y?o=360-o:e.y<t.y?o=o:e.y==t.y&&(o=0):e.x==t.x&&(e.y>t.y?o=270:e.y<t.y&&(o=90)),o},t}(BaseClass);__reflect(MathUtils.prototype,"MathUtils");var ObjectPool=function(){function e(){this._objs=new Array}return e.prototype.pushObj=function(e){this._objs.push(e)},e.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},e.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},e.pop=function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];e._content[n]||(e._content[n]=[]);var i=e._content[n];if(i.length)return i.pop();var a,s=r.length;return 0==s?a=new t:1==s?a=new t(r[0]):2==s?a=new t(r[0],r[1]):3==s?a=new t(r[0],r[1],r[2]):4==s?a=new t(r[0],r[1],r[2],r[3]):5==s&&(a=new t(r[0],r[1],r[2],r[3],r[4])),a.ObjectPoolKey=n,a},e.popWithExtraKey=function(t,n){e._content[t]||(e._content[t]=[]);var r,o=e._content[t];if(o.length)for(var i=0;i<o.length;i++)if(o[i].extraKey==n){r=o[i],o.splice(i,1);break}if(!r){var a=t;r=new a(n),r.extraKey=n,r.ObjectPoolKey=t}return r},e.push=function(t){if(null==t)return!1;var n=t.ObjectPoolKey;return e._content[n]?(e._content[n].push(t),!0):!1},e.clear=function(){e._content={}},e.clearClass=function(t,n){void 0===n&&(n=null);for(var r=e._content[t];r&&r.length;){var o=r.pop();n&&o[n](),o=null}e._content[t]=null,delete e._content[t]},e.dealFunc=function(t,n){var r=e._content[t];if(null!=r){var o=0,i=r.length;for(o;i>o;o++)r[o][n]()}},e._content={},e}();__reflect(ObjectPool.prototype,"ObjectPool");var ObjectUtils=function(){function e(){}return e.copyValue=function(e,t){for(var n in t){var r=(t[n],this.isBaseType(t[n]));r?e[n]=t[n]:this.copyValue(e[n],t[n])}},e.isBaseType=function(t){var n=egret.getQualifiedClassName(t),r=e.BASETYPES.indexOf(n);return-1!=r},e.copyValue2=function(e,t){if(null!=t)for(var n in e)if("__class__"!=n&&"__types__"!=n){var r=t[n];void 0!=r&&(e[n]=t[n])}},e.prototype.copyDataHandler=function(e){var t;if(e instanceof Array)t=[];else{if(!(e instanceof Object))return e;t={}}for(var n=Object.keys(e),r=0,o=n.length;o>r;r++){var i=n[r];t[i]=this.copyDataHandler(e[i])}return t},e.copyListToAnyInfo=function(t,n,r){if(!t||t.length<1)return null;var o=[];return t.forEach(function(t,i){var a=ObjectPool.pop(n,r);e.copyValue2(a,t),o.push(a)}),o},e.removeFromArray=function(e,t){var n=t.indexOf(e);return n>=0&&t.splice(n,1),t},e.splitToNumber=function(e,t){void 0===t&&(t=",");for(var n=[],r=e.split(t),o=0;o<r.length;o++)n.push(parseInt(r[o]));return n},e.splitToString=function(e,t){void 0===t&&(t=",");for(var n=[],r=e.split(t),o=0;o<r.length;o++)n.push(r[o]);return n},e.splitMapData=function(t){for(var n=[],r=t.split("#"),o=0;o<r.length;o++){var i=e.splitToNumber(r[o].toString());n.push(i)}return n},e.splitLevelMapPoints=function(t,n){if(void 0===n&&(n="#"),null==t)return[];for(var r=[],o=e.splitToString(t),i=0;i<o.length;i++)r.push(e.converToPoint(o[i]));return r},e.converToPoint=function(e,t){if(void 0===t&&(t=","),null==e)return null;var n=String(e).split(t);return new egret.Point(parseFloat(n[0]),parseFloat(n[1]))},e.converToRectangle=function(e){if(null==e)return null;var t=e.toString().split(",");return new egret.Rectangle(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))},e.removeAllArrayItem=function(e){for(var t=0;t<e.length;t++)e.pop()},e.replaceItemToArray=function(e,t,n){e.splice(t,1,n)},e.getRandomFromIn=function(e){if(null==e||e.length<1)return 0;var t=e[0]+Math.random()*(e[1]-e[0]),n=Math.floor(t);return n},e.getRandomStr=function(t,n){void 0===n&&(n="#");var r=t.split(n);return e.getRandomItem(r)},e.getRandomItem=function(e){if(null==e||e.length<1)return null;var t=Math.random()*e.length,n=Math.floor(t);return e[n]},e.shuffle=function(e){for(var t=e.length,n=t;n--;){var r=Math.floor(Math.random()*t);if(n!=r){var o=e[n];e[n]=e[r],e[r]=o}}},e.charExchange=function(e){for(var t=e,n=0;n<t.length;n++){t.substr(n,1)}return t},e.splitToPoints=function(e){var t=[],n=String(e);if("0"==n)return t;for(var r=n.split("|"),o=0;o<r.length;o++){var i=r[o].split(",");t.push(new egret.Point(parseFloat(i[0]),parseFloat(i[1])))}return t},e.pointIsInArea=function(e,t,n){return e.contains(t,n)},e.BASETYPES=["boolean","number","string","null"],e.BIGNUMBERKEY=["baseCost","baseAttack","baseLife"],e}();__reflect(ObjectUtils.prototype,"ObjectUtils");var RandomUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.limit=function(e,t){e=Math.min(e,t),t=Math.max(e,t);var n=t-e;return e+Math.random()*n},t.prototype.limitInteger=function(e,t){return Math.round(this.limit(e,t))},t.prototype.randomArray=function(e){var t=Math.floor(Math.random()*e.length);return e[t]},t.prototype.randrange=function(e,t,n){if(void 0===n&&(n=1),0==n)throw new Error("step 不能为 0");var r=t-e;if(0==r)throw new Error("没有可用的范围("+e+","+t+")");0>r&&(r=e-t);var o=Math.floor((r+n-1)/n);return Math.floor(Math.random()*o)*n+Math.min(e,t)},t.prototype.randint=function(e,t){return e>t?e++:t++,this.randrange(e,t)},t}(BaseClass);__reflect(RandomUtils.prototype,"RandomUtils");var ResourcePool=function(){function e(){this.main={},this.main[e.SKE]={},this.main[e.BITMAPTEXT]={},this.main[e.BITMAP]={}}return Object.defineProperty(e,"Instance",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.createOneByType=function(t,n){switch(n==e.Trace_ID&&Log.trace("ResourcePool . {0} : {1}","createOneByType",n),t){case e.SKE:var r=new BoneAnimation(n);BoneConfig.copyValueFromTemplate(r,n);return r.name=n,r.load(),r;case e.BITMAPTEXT:var o=new egret.BitmapText;return o.name=n,o.font=RES.getRes(n),o;case e.BITMAP:var i=new egret.Bitmap;return i.name=n,i.texture=RES.getRes(n),i}Log.trace("Can't Create Instance of : "+t+"with ResId: "+n)},e.prototype.getPoolByType=function(t){switch(t){case e.SKE:return this.main[e.SKE];case e.BITMAPTEXT:return this.main[e.BITMAPTEXT];case e.BITMAP:return this.main[e.BITMAP]}return null},e.prepareItem=function(t,n){switch(n){case e.SKE:t instanceof BoneAnimation?t.initBone():Log.trace("item type not match!!"+t.name+"  type :"+n)}},e.prototype.pop=function(t,n){var r=this.getPoolByType(n);null==r[t]&&(r[t]=[]),t==e.Trace_ID&&Log.trace("ResourcePool . {0} : {1}","pop",t);var o=r[t];if(o.length>0){var i=o.pop();return e.prepareItem(i,n),i}return e.createOneByType(n,t)},e.prototype.push=function(t,n){if(null!=t){var r=this.getPoolByType(n);if(null==r[t.name])return void Log.trace("回收对象的数组不存在",t.name);t.name==e.Trace_ID&&Log.trace("ResourcePool . {0} : {1}","push",t.name),r[t.name].push(t);var o=t.parent;null!=o&&o.removeChild(t),App.DisplayUtils.resetDisplay(t),t.resetForPool&&t.resetForPool()}},e.prototype.create=function(t,n,r){void 0===r&&(r=1);var o,i=[];for(t==e.Trace_ID&&Log.trace("ResourcePool . {0} : {1}  {2}","create",t,r),o=0;r>o;o++)i.push(this.pop(t,n));for(o=0;r>o;o++)this.push(i.pop(),n)},e.prototype.hasItem=function(e,t){if(null==e)return!1;var n=this.getPoolByType(t);if(null==n[e.name])return!1;var r=n[e.name];return r.indexOf(e)>=0},e.prototype.getLen=function(e,t){var n=this.getPoolByType(t);return n[e]?n[e].length:0},e.prototype.clear=function(t,n,r){function o(e){null!=e&&(r&&this.dealFun(e.name,n,r),e=null,delete i[e.name])}void 0===r&&(r="dispose");var i=this.getPoolByType(n);if(t==e.Trace_ID&&Log.trace("ResourcePool . {0} : {1}  {2}","clear",t,n),""==t)for(var a in i)o(i[a]);else o(i[t])},e.prototype.dealFun=function(e,t,n){var r=this.getPoolByType(t);if(r[e])for(var o=r[e],i=o.length,a=0;i>a;a++)o[a][n]&&o[a][n]()},e.prototype.printAll=function(){Log.trace("Start Print All Resource-------------");var e=0;for(var t in this.main){Log.trace("Start Print All Resource by type : "+t+"==================");for(var n in this.main[t]){var r=this.main[t][n].length;Log.trace("key :"+n+"  count:"+r),e+=r}}Log.trace("Start Print All Resource count : "+e+"==================")},e.SKE="Animation",e.BITMAPTEXT="BitmapText",e.BITMAP="Bitmap",e.Trace_ID="tx_01",e}();__reflect(ResourcePool.prototype,"ResourcePool");var ResUtil=function(e){function t(){var t=e.call(this)||this;return t._loadingGroups=[],t._configs=new Array,t._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,t.onResourceLoadComplete,t),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,t.onResourceLoadProgress,t),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,t.onResourceLoadError,t),t}return __extends(t,e),t.prototype.addConfig=function(e,t){this._configs.push([e,t])},t.prototype.loadConfig=function(e,t){this._onConfigComplete=e,this._onConfigCompleteTarget=t,this.loadNextConfig()},t.prototype.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var e=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(e[0],e[1])},t.prototype.onConfigCompleteHandle=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},t.prototype.loadGroupQuiet=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=null);var r=this.combGroupName(e);this._loadingGroups.indexOf(r)<0&&(this._loadingGroups.push(r),RES.loadGroup(r,t,n))},t.prototype.loadGroup=function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=null);var i=this.combGroupName(e);this.createGroupInfo(i,t,null,n),this._loadingGroups.indexOf(i)<0&&(this._loadingGroups.push(i),RES.loadGroup(i,r,o))},t.prototype.loadGroupWithPro=function(e,t,n,r){var o=this.combGroupName(e);this.createGroupInfo(o,t,n,r),this._loadingGroups.indexOf(o)<0&&(this._loadingGroups.push(o),RES.loadGroup(o))},t.prototype.combGroupName=function(e){if("string"==typeof e)return e;for(var t=e.length,n="",r=0;t>r;r++)n+=e[r];return RES.createGroup(n,e,!1),n},t.prototype.createGroupInfo=function(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),this._groups[e]||(this._groups[e]=[]),this._groups[e].push({onComplete:t,thisObject:r,onProgress:n})},t.prototype.onResourceLoadComplete=function(e){var t=e.groupName;if(RES.isGroupLoaded(t)){var n=this._loadingGroups.indexOf(t);if(n>=0&&this._loadingGroups.splice(n,1),this._groups[t]){for(var r=0;r<this._groups[t].length;r++){var o=this._groups[t][r].onComplete,i=this._groups[t][r].thisObject;null!=o&&o.call(i)}this._groups[t]=null,delete this._groups[t]}}},t.prototype.onResourceLoadProgress=function(e){var t=e.groupName;if(this._groups[t])for(var n=0;n<this._groups[t].length;n++){var r=this._groups[t][n].onProgress,o=this._groups[t][n].thisObject;null!=r&&r.call(o,e)}},t.prototype.onResourceLoadError=function(e){this.onResourceLoadComplete(e)},t.prototype.loadAsyncSound=function(e,t){return void 0===t&&(t=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return RES.getResByUrl(PathConfig.SoundPath+e,function(){t&&t()},this,RES.ResourceItem.TYPE_SOUND),[2]})})},t.PRIORITY_H=10,t.PRIORITY_M=5,t.PRIORITY_L=1,t}(BaseClass);__reflect(ResUtil.prototype,"ResUtil");var RockerUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(e,t,n,r){this.keys=[0,0],this.mouseX=-1,this.mouseY=-1,this.moveFlag=t,this.moveFlagX=t.x,this.moveFlagY=t.y,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.moveFlagWidthHelf=.5*e.width,this.moveFlagRec=new egret.Rectangle(this.moveFlagX-.5*e.width,this.moveFlagY-.5*e.height,e.width,e.height),this.moveFlagCheckRec=new egret.Rectangle(0,0,.5*App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.dealKeyFunc=n,this.dealKeyTarget=r,this.moveFlag.touchEnabled=!0,this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.moveFlag.addEventListener(egret.TouchEvent.TOUCH_TAP,this.stopEvent,this),App.StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_END,this.leaveStateEvent,this),App.StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_MOVE,this.heroMoveEvent,this),App.KeyboardUtils.addKeyDown(this.onKeyDown,this),App.KeyboardUtils.addKeyUp(this.onKeyUp,this)},t.prototype.onKeyDown=function(e){switch(e){case Keyboard.A:this.keys[0]=-1,this.startCheckKey();break;case Keyboard.D:this.keys[0]=1,this.startCheckKey();break;case Keyboard.W:this.keys[1]=-1,this.startCheckKey();break;case Keyboard.S:this.keys[1]=1,this.startCheckKey()}},t.prototype.onKeyUp=function(e){switch(e){case Keyboard.A:-1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.D:1==this.keys[0]&&(this.keys[0]=0);break;case Keyboard.W:-1==this.keys[1]&&(this.keys[1]=0);break;case Keyboard.S:1==this.keys[1]&&(this.keys[1]=0)}},t.prototype.stopEvent=function(e){e.stopPropagation()},t.prototype.leaveStateEvent=function(e){e.stageX==this.mouseX&&e.stageY==this.mouseY&&this.stopMove()},t.prototype.startMove=function(e){this.isMoveing=!0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=e.stageX,this.mouseY=e.stageY},t.prototype.stopMove=function(){this.isMoveing=!1,this.keys[0]=0,this.keys[1]=0,this.moveFlagGoX=this.moveFlagX,this.moveFlagGoY=this.moveFlagY,this.mouseX=-1,this.mouseY=-1},t.prototype.resetRockerPos=function(){this.moveFlag.x=this.moveFlagX,this.moveFlag.y=this.moveFlagY},t.prototype.heroMoveEvent=function(e){this.runMove(e.stageX,e.stageY)},t.prototype.runMove=function(e,t){if(this.isMoveing&&(this.moveFlagCheckRec.contains(e,t)||!(Math.abs(this.mouseX-e)>50||Math.abs(this.mouseY-t)>50))){if(this.mouseX=e,this.mouseY=t,this.moveFlagRec.contains(this.mouseX,this.mouseY))this.moveFlagGoX=this.mouseX,this.moveFlagGoY=this.mouseY;else{var n=App.MathUtils.getRadian2(this.moveFlagX,this.moveFlagY,this.mouseX,this.mouseY);
this.moveFlagGoX=this.moveFlagX+Math.cos(n)*this.moveFlagWidthHelf,this.moveFlagGoY=this.moveFlagY+Math.sin(n)*this.moveFlagWidthHelf}this.moveFlagGoX>this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=1:this.moveFlagGoX<this.moveFlagX&&Math.abs(this.moveFlagGoX-this.moveFlagX)>10?this.keys[0]=-1:this.keys[0]=0,this.moveFlagGoY>this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=1:this.moveFlagGoY<this.moveFlagY&&Math.abs(this.moveFlagGoY-this.moveFlagY)>10?this.keys[1]=-1:this.keys[1]=0,this.startCheckKey()}},t.prototype.startCheckKey=function(){this.checkKeying||(this.checkKeying=!0,App.TimerManager.doFrame(1,0,this.delKeys,this))},t.prototype.stopCheckKey=function(){this.keys[0]=0,this.keys[1]=0,this.checkKeying&&(App.TimerManager.remove(this.delKeys,this),this.checkKeying=!1)},t.prototype.delKeys=function(){-1==this.mouseX||this.moveFlagCheckRec.contains(this.mouseX,this.mouseY)||this.stopMove(),this.moveFlag.x!=this.moveFlagGoX&&(this.moveFlag.x=this.moveFlagGoX),this.moveFlag.y!=this.moveFlagGoY&&(this.moveFlag.y=this.moveFlagGoY),this.keys[0]||this.keys[1]||this.stopCheckKey(),this.dealKeyFunc.call(this.dealKeyTarget,this.keys[0],this.keys[1])||this.resetRockerPos()},t.prototype.stop=function(){this.stopCheckKey(),this.stopMove()},t}(BaseClass);__reflect(RockerUtils.prototype,"RockerUtils");var ShakeUtils=function(e){function t(){var t=e.call(this)||this;return t.MAP=0,t.SPRITE=1,t.mapPoss=[new egret.Point(0,3),new egret.Point(0,0),new egret.Point(0,-2)],t.spritePoss=[new egret.Point(5,0),new egret.Point(-5,0),new egret.Point(5,0)],t._shockLength=0,t._shockCount=0,t._rx=0,t._ry=0,t._type=0,t._repeatCount=0,t}return __extends(t,e),t.prototype.destroy=function(){this.stop()},t.prototype.shock=function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=null),void 0===n&&(n=3),this._target||(this._type=e,this._target=t,this._type==this.MAP?(this._shockPoss=this.mapPoss.concat(),this._shockLength=this._shockPoss.length):this._type==this.SPRITE&&(this._shockPoss=this.spritePoss.concat(),this._shockLength=this._shockPoss.length),this.start(n))},t.prototype.start=function(e){void 0===e&&(e=1),this.repeatCount=e,this._shockCount=0,this._target&&(this._type!=this.MAP&&(this._rx=this._target.x),this._ry=this._target.y,App.TimerManager.doFrame(1,0,this.onShockEnter,this))},t.prototype.stop=function(){this._target&&(this._type!=this.MAP&&(this._target.x=this._rx),this._target.y=this._ry,App.TimerManager.remove(this.onShockEnter,this)),this._target=null},t.prototype.onShockEnter=function(e){var t=this._shockLength*this._repeatCount;if(this._shockCount>=t)return void this.stop();var n=this._shockCount%this._shockLength,r=this._shockPoss[n];this._target&&(this._type!=this.MAP&&(this._target.x=this._rx+r.x),this._target.y=this._ry+r.y),this._shockCount++},Object.defineProperty(t.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(e){this._repeatCount=e},enumerable:!0,configurable:!0}),t}(BaseClass);__reflect(ShakeUtils.prototype,"ShakeUtils");var StageUtils=function(e){function t(){var n=e.call(this)||this,r=n;return null==t._uiStage&&(t._uiStage=new eui.UILayer,t._uiStage.percentHeight=100,t._uiStage.percentWidth=100,t._uiStage.touchEnabled=!1,n.getStage().addChild(t._uiStage)),r._stageRect=new egret.Rectangle(0,0,r.getWidth(),r.getHeight()),n}return __extends(t,e),t.prototype.getStageRect=function(){return this._stageRect},t.prototype.getHeight=function(){return this.getStage().stageHeight},t.prototype.getWidth=function(){return this.getStage().stageWidth},t.prototype.setTouchChildren=function(e){this.getStage().touchChildren=e},t.prototype.setMaxTouches=function(e){this.getStage().maxTouches=e},t.prototype.setFrameRate=function(e){this.getStage().frameRate=e},t.prototype.setScaleMode=function(e){this.getStage().scaleMode=e},t.prototype.getStage=function(){return egret.MainContext.instance.stage},t.prototype.getUIStage=function(){return t._uiStage},t.prototype.startFullscreenAdaptation=function(e,t,n){this.designWidth=e,this.designHeight=t,this.resizeCallback=n,this.stageOnResize()},t.prototype.stageOnResize=function(){this.getStage().removeEventListener(egret.Event.RESIZE,this.stageOnResize,this);var e=this.designWidth,t=this.designHeight,n=window.innerWidth,r=window.innerHeight,o=n/r,i=e/t,a=o/i;if(o>i){var s=a,l=a;e=Math.floor(e*s),t=Math.floor(t*l)}this.getStage().setContentSize(e,t),this.resizeCallback&&this.resizeCallback(),this.getStage().addEventListener(egret.Event.RESIZE,this.stageOnResize,this)},t}(BaseClass);__reflect(StageUtils.prototype,"StageUtils");var StringUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.trimSpace=function(e){return e.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},t.prototype.getStringLength=function(e){for(var t=e.split(""),n=0,r=0;r<t.length;r++){var o=t[r];n+=this.isChinese(o)?2:1}return n},t.prototype.isChinese=function(e){var t=/^.*[\u4E00-\u9FA5]+.*$/;return t.test(e)},t}(BaseClass);__reflect(StringUtils.prototype,"StringUtils");var TimeUtil=function(){function e(){this._initializeSTime=0,this._initializeCTime=0,this._firstSTime=0,this._isLogin=!1}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.getCDTime=function(e){if(!(0>e)){var t=Math.floor(e/1e3/60/60).toString(),n=Math.floor(e%36e5/6e4).toString(),r=Math.floor(e%6e4/1e3).toString();return Number(t)>0?t+"h":Number(n)>0?n+"m":Number(r)>0?r+"s":"0"}},e.S2H=function(e,t,n){if(void 0===t&&(t=":"),void 0===n&&(n=!0),!(0>e)){var r=Math.floor(e/1e3/60/60).toString(),o=Math.floor(e%36e5/6e4).toString(),i=Math.floor(e%6e4/1e3).toString();if(Number(r)<10&&(r="0"+r),Number(o)<10&&(o="0"+o),Number(i)<10&&(i="0"+i),n)var a=r+t+o+t+i;else var a=o+t+i;return a}},e.conversionTime=function(t){if(0>=t)return"";if(t>=86400){var n=Math.floor(t/86400);return n+"天"}if(t>=3600){var r=Math.floor(t/3600);return r+"小时"}return e.S2H(1e3*t)},e.getHours=function(e){return 0>e?void 0:Math.floor(e/1e3/60/60)},e.fornatStr=function(t){var n=t.split("|"),r={};if(n&&n.length)for(var o=0;o<n.length;o++){var i=e.fornatStr1(n[o]),a={id:i[0],itemtType:i[1],num:i[2]};r[i[0]]=a}return r},e.fornatStr1=function(e,t){void 0===t&&(t="#");var n=e.split(t);return n},e.prototype.getCurServerTime=function(){var e=this._initializeSTime+Math.floor((new Date).getTime()/1e3)-this._initializeCTime;return e},e.prototype.getEndTime=function(e){return this._firstSTime+e},e.prototype.getCDTime=function(e){var t=this.getEndTime(e),n=this.getCurServerTime();return n>=t?0:t-n},e.prototype.getCDTimes=function(e){var t=this.getCurServerTime();if(t>=e)return 0;var n=e-t;return n},e.prototype.synctime=function(e,t){this._initializeCTime=t,this._initializeSTime=e,this._isLogin||(this._firstSTime=e,this._isLogin=!0)},e.prototype.calculationTimestamp=function(e){var t=e-1e3*this.getCurServerTime();return t=Math.floor(t)},e.fornateTimestamp=function(e){var t=new Date;t.setTime(e);var n=t.getTime();return n=Math.floor(n/1e3)},e.getDay=function(e){if(!(0>=e)){var t=new Date;return t.setTime(e),t.getDate()+"天"}},e}();__reflect(TimeUtil.prototype,"TimeUtil");var utils;!function(e){var t;!function(e){function t(e){var t="",n=new Date;return n.setTime(e),t+=n.getFullYear(),t+="-"+a(n),t+="-"+s(n),t+="  "+l(n),t+=":"+c(n),t+=":"+p(n)}function n(e){var t="",n=new Date;return n.setTime(e),t+=n.getFullYear(),t+=a(n),t+=s(n),parseInt(t)}function r(e){var t="",n=new Date;return n.setTime(e),t+=a(n)+"月",t+=s(n)+"日"}function o(e){var t="",n=new Date;return n.setTime(e),t+=l(n),t+=c(n),t+=p(n),parseInt(t)}function i(e){var t="",n=new Date;return n.setTime(e),t+=l(n),t+=":"+c(n)}function a(e){var t="";return t=e.getMonth()+1,parseInt(t)<10&&(t="0"+t),t}function s(e){var t="";return t=e.getDate(),parseInt(t)<10&&(t="0"+t),t}function l(e){var t="";return t=e.getHours(),parseInt(t)<10&&(t="0"+t),t}function c(e){var t="";return t=e.getMinutes(),parseInt(t)<10&&(t="0"+t),t}function p(e){var t="";return t=e.getSeconds(),parseInt(t)<10&&(t="0"+t),t}e.datetimeFormat=t,e.getYYMMDD=n,e.MMDDFormat=r,e.getHHMMSS=o,e.HHMMFormat=i}(t=e.timer||(e.timer={}))}(utils||(utils={}));var HttpConst=function(){function e(){}return e.USER_LOGIN="User.login",e}();__reflect(HttpConst.prototype,"HttpConst");var BattleController=function(e){function t(){var t=e.call(this)||this,n=t;return n._battleView=new BattleView(n,LayerManager.GAME_MAP_LAYER),App.ViewManager.register(ViewConst.Battle,n._battleView),n._battleModel=new BattleModel(n),n.setModel(n._battleModel),n._battleProxy=new BattleProxy(n),n.registerFunc(BattleConst.BATTLE_INIT,n.onBattleInit,n),n.registerFunc(BattleConst.BATTLE_SELECT_LEVEL,n.onShowMissionPanel,n),n.registerFunc(BattleConst.BATTLE_ENTER_MISSION,n.onEnterBattleMission,n),t}return __extends(t,e),t.prototype.onBattleInit=function(){var e=this;App.ViewManager.open(ViewConst.Battle),e.initRegisterView()},t.prototype.initRegisterView=function(){var e=this;App.ViewManager.register(ViewConst.MissionPanel,new MissionPanel(e,LayerManager.GAME_UI_LAYER)),App.ViewManager.register(ViewConst.BattleMission,new BattleMissionView(e,LayerManager.GAME_UI_LAYER))},t.prototype.onShowMissionPanel=function(e){App.ViewManager.open(ViewConst.MissionPanel,e)},t.prototype.onEnterBattleMission=function(e){App.ViewManager.open(ViewConst.BattleMission,e)},t}(BaseController);__reflect(BattleController.prototype,"BattleController");var BattleLogic=function(){function e(){}return e.pushCleanCell=function(t,n){App.GridManager.clearList.push(t);var r=App.GridManager.clearList.length;if(r>1){var o=App.GridManager.clearList[r-2];e.drawLine(n,o,t)}},e.createCell=function(e,t,n,r){var o=new Grid(r);return o.row=t,o.column=n,App.GridManager.gridArray[t][n]=o,e.addChild(o),o},e.createPointLine=function(e,t,n){e&&e.parent&&e.parent.removeChild(e),e=new eui.Image,e.texture=RES.getRes("line_png"),e.width=0,e.anchorOffsetX=0,e.anchorOffsetY=e.height/2,e.x=n.x,e.y=n.y,t.addChild(e)},e.deleteCleanList=function(){App.GridManager.clearList=[],App.GridManager.lineArray=[],this.cleanIndex=0},e.dropAndFillCell=function(t){for(var n=App.GridManager.row-1;n>=0;n--)for(var r=0;r<App.GridManager.column;r++){var o=App.GridManager.gridArray[n][r];if(null!=o){var i=App.GridManager.getDropRowAndColumn(o),a=i.row,s=i.column;(o.row!=a||o.column!=s)&&o.drop(i.row,i.column)}}var l=App.GridManager.getEmptyGrid();for(var c in l){var p=l[c].row,u=l[c].column,h=App.GridManager.genDropGridId(p,u),g=e.createCell(t,p,u,h);g.x=App.GridManager.getGridPosX(u),g.y=-Grid.Height/2,g.drop(p,u)}},e.createDirtyAndScore=function(e,t){var n=new eui.Image("battle_icon_"+t.id),r=RES.getRes("battle_icon_"+t.id);n.anchorOffsetX=r.textureWidth/2,n.anchorOffsetY=r.textureHeight/2,n.x=t.x,n.y=t.y,n.scaleX=n.scaleY=0;var o=360*Math.random();n.rotation=o,e.addChild(n);var i=egret.Tween.get(n);i.to({scaleX:1.2,scaleY:1.2},400,egret.Ease.bounceOut).wait(200).to({alpha:0},100).call(function(e){e&&e.parent&&e.parent.removeChild(e)},this,[n])},e.doTouchBegan=function(t,n,r,o,i){e.deleteCleanList();var a=App.GridManager.getTouchGrid(o,i);if(a){a.selectState=!0,e.pushCleanCell(a,n),Log.trace("row: "+a.row+", column: "+a.column);var s=new egret.Point(a.x,a.y);e.createPointLine(t,n,s),r=a}},e.doTouchMoveEnd=function(e,t){var n=App.GridManager.clearList.length;Log.trace("可以消除的数量为: "+n),n>=App.GridManager.baseCleanNum&&e==BattleState.Play&&(e=BattleState.DealLogic,t());for(var r in App.GridManager.clearList){var o=App.GridManager.clearList[r];o.selectState=!1}},e.doTouchMove=function(t,n,r,o,i){e.updatePointLineEnd(t,n,r,o,i);var a=App.GridManager.getTouchGrid(o,i);if(a)if(a.isSelected){var s=App.GridManager.getIsLastTwoInClearList(a);if(s){App.GridManager.removeTopLine();var l=App.GridManager.removeTopItemInCleanList();l.setSelect(!1),this.updatePointLineBegan(t,n,r,o,i)}}else{var c=App.GridManager.getClearListId(),p=App.GridManager.isInArround(a);a.id==c&&p&&(a.selectState=!0,e.pushCleanCell(a,n),this.updatePointLineBegan(t,n,r,o,i))}},e.updatePointLineEnd=function(e,t,n,r,o){if(e&&n){var i=new egret.Point(n.x,n.y),a=t.globalToLocal(r,o),s=egret.Point.distance(i,a);e.width=s,e.x=i.x,e.y=i.y,e.anchorOffsetX=0,e.anchorOffsetY=e.height/2;var l=App.MathUtils.getLineAngle(i,a);e.rotation=l}},e.updatePointLineBegan=function(e,t,n,r,o){var i=App.GridManager.clearList.length;if(i>0){var a=App.GridManager.clearList[i-1];n=a,this.updatePointLineEnd(e,t,n,r,o)}},e.drawLine=function(e,t,n){var r=RES.getRes("line_png"),o=new eui.Image;o.texture=r,o.anchorOffsetX=0,o.anchorOffsetY=r.textureHeight/2,e.addChild(o),App.GridManager.lineArray.push(o),o.x=t.x,o.y=t.y;var i=new egret.Point(t.x,t.y),a=new egret.Point(n.x,n.y),s=egret.Point.distance(i,a);o.width=s;var l=App.MathUtils.getLineAngle(i,a);o.rotation=l},e.cleanIndex=0,e}();__reflect(BattleLogic.prototype,"BattleLogic");var BattleProxy=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(BaseProxy);__reflect(BattleProxy.prototype,"BattleProxy");var BattleConst=function(){function e(){}return e.BATTLE_INIT=11e3,e.BATTLE_SELECT_LEVEL=11001,e.BATTLE_ENTER_MISSION=11002,e.GRID_RESET_COMPLETE=11003,e.GRID_DROP_COMPLETE=11004,e}();__reflect(BattleConst.prototype,"BattleConst");var Grid=function(e){function t(t){var n=e.call(this)||this;n.id=0,n.row=0,n.column=0,n.moveFlag=!1,n.checkMark=!1,n.isSelected=!1,n.isAction=!1,n.moveSpeed=400;var r=n;return r.id=t,r._icon=new eui.Image,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAddToStage,r),n}return __extends(t,e),t.prototype.onAddToStage=function(){var e=this;e.init()},t.prototype.init=function(){var e=this,n=RES.getRes("battle_icon_"+e.id);n&&(e._icon.source=n,e._icon.width=e.width=t.Width,e._icon.height=e.height=t.Height,e._icon.anchorOffsetX=e.anchorOffsetX=e._icon.width<<1,e._icon.anchorOffsetY=e.anchorOffsetY=e._icon.height<<1,e._icon.x=e.width<<1,e._icon.y=e.height<<1)},Object.defineProperty(t.prototype,"selectState",{set:function(e){var t=this;t.isSelected!=e&&(t.isSelected=e,e&&t.doSelectedTween())},enumerable:!0,configurable:!0}),t.prototype.doSelectedTween=function(){var e=this;if(0==e.isAction){e.isAction=!0,egret.Tween.removeTweens(e);var t=egret.Tween.get(e);t.to({scaleX:.8,scaleY:1.3},100,egret.Ease.bounceIn).to({scaleX:1.1,scaleY:1},100,egret.Ease.bounceOut).to({scaleX:1,scaleY:1},100,egret.Ease.backIn).call(function(){e.isAction=!1},e)}},t.prototype.reset=function(){var e=this;ObjectUtils.removeFromArray(e,App.GridManager.clearList),App.GridManager.clearGrid(e);var t=egret.Tween.get(e);t.to({scaleX:.4,scaleY:.4},200).call(function(){e.resetComplete()},e).wait(50).call(function(t){e.parent?e.parent.removeChild(e):egret.log("no parent")},e,[e])},t.prototype.resetComplete=function(){App.ControllerManager.applyFunc(ControllerConst.Battle,BattleConst.GRID_RESET_COMPLETE)},t.prototype.drop=function(e,t){var n=this,r=App.GridManager.getGridPosX(t),o=App.GridManager.getGridPosY(e),i=App.MathUtils.getDistance(n.x,n.y,r,o),a=i/n.moveSpeed*1e3;n.moveFlag=!0,App.GridManager.setGrid(n,e,t);var s=egret.Tween.get(n);s.to({x:r,y:o},a,egret.Ease.bounceOut).call(function(){n.moveFlag=!1,n.dropComplete()},n)},t.prototype.dropComplete=function(){App.ControllerManager.applyFunc(ControllerConst.Battle,BattleConst.GRID_DROP_COMPLETE)},t.Width=79,t.Height=79,t}(egret.Sprite);__reflect(Grid.prototype,"Grid");var GridManager=function(e){function t(){var t=e.call(this)||this;return t.gridArray=[],t.clearList=[],t.lineArray=[],t.row=6,t.rowSpace=20,t.column=6,t.columnSpace=20,t.baseCleanNum=3,t}return __extends(t,e),t.prototype.cleanGridArray=function(){var e=this;e.gridArray=[];for(var t=0;t<e.row;t++){e.gridArray.push([]);for(var n=0;n<e.column;n++)e.gridArray[t].push(null)}},t.prototype.genDropGridId=function(e,t){var n=[1,2,3,4,5],r=Math.random()*n.length,o=Math.floor(r);return n[o]},t.prototype.genInitGridId=function(e,t){var n=RES.getRes("gameCellCfg_json"),r=n[1],o=r[e][t];return o},t.prototype.removeAllGridAction=function(){var e=this;for(var t in e.gridArray)for(var n in e.gridArray[t]){var r=e.gridArray[t][n];r&&(egret.Tween.removeTweens(r),r.scaleX=r.scaleY=1)}},t.prototype.setAllGridCheckMark=function(e){var t=this;for(var n in t.gridArray)for(var r in t.gridArray[n]){var o=t.gridArray[n][r];o&&(o.checkMark=e)}},t.prototype.getNowCleanListNum=function(){var e=this,t=[];for(var n in e.gridArray)for(var r in e.gridArray[n]){var o=e.gridArray[n][r];if(o&&0==o.checkMark){var i=[o];e.getSameArrByGrid(o,i),i.length>=e.baseCleanNum&&t.push(i)}}return e.setAllGridCheckMark(!1),t},t.prototype.getSameArrByGrid=function(e,t){var n=this,r=e.row,o=e.column,i=e.id;e.checkMark=!0;var a=r,s=o-1;if(s>=0){var l=n.gridArray[a][s];l.id==i&&0==l.checkFlag&&(l.checkFlag=!0,n.getSameArrByGrid(l,t),t.push(l))}var c=r,p=o+1;if(p<n.column){var u=n.gridArray[c][p];u.id==i&&0==u.checkFlag&&(u.checkFlag=!0,n.getSameArrByGrid(u,t),t.push(u))}var h=r+1,g=o;if(h<n.row){var f=n.gridArray[h][g];f.id==i&&0==f.checkFlag&&(f.checkFlag=!0,n.getSameArrByGrid(f,t),t.push(f))}var d=r-1,y=o;if(d>=0){var _=n.gridArray[d][y];_.id==i&&0==_.checkFlag&&(_.checkFlag=!0,n.getSameArrByGrid(_,t),t.push(_))}},t.prototype.setGrid=function(e,t,n){var r=this,o=e.row,i=e.column;r.gridArray[o][i]=null,e.row=t,e.column=n,r.gridArray[t][n]=e},t.prototype.clearGrid=function(e){var t=this,n=e.row,r=e.column;t.gridArray[n][r]=null},t.prototype.getGridPosX=function(e){var t=this,n=Grid.Width/2,r=e*(Grid.Width+t.columnSpace)+n;return r},t.prototype.getGridPosY=function(e){var t=this,n=Grid.Height/2,r=e*(Grid.Height+t.rowSpace)+n;return r},t.prototype.getTouchGrid=function(e,t){var n=this;for(var r in n.gridArray){var o=n.gridArray[r];for(var i in o){var a=o[i];if(a){var s=a.hitTestPoint(e,t);if(s)return a}}}return null},t.prototype.getClearListId=function(){var e=this;if(e.clearList.length>0){var t=e.clearList[0];return t.id}return 0},t.prototype.isInArround=function(e){var t=this,n=e.row,r=e.column,o=t.clearList.length;if(o>0){var i=t.clearList[o-1],a=i.row,s=i.column;if(!(a!=n+1&&a!=n-1&&a!=n||s!=r+1&&s!=r-1&&s!=r))return!0}return!1},t.prototype.getIsLastTwoInClearList=function(e){var t=this,n=t.clearList.length;if(n>=2){var r=n-2,o=t.clearList[r];if(o==e)return!0}return!1},t.prototype.removeTopItemInCleanList=function(){var e=this,t=e.clearList.length;if(t>0){var n=e.clearList[t-1];return ObjectUtils.removeFromArray(n,e.clearList),n}},t.prototype.removeTopLine=function(){var e=this,t=e.lineArray.length;if(t>0){var n=e.lineArray[t-1];ObjectUtils.removeFromArray(n,e.lineArray),n.parent&&App.DisplayUtils.removeFromParent(n)}},t.prototype.isAllMove=function(){var e=this;for(var t in e.gridArray){var n=e.gridArray[t];for(var r in n){var o=n[r];if(o&&1==o.moveFlag)return!0}}return!1},t.prototype.getEmptyGrid=function(){for(var e=this,t=[],n=e.row-1;n>=0;n--)for(var r=0;r<e.column;r++){var o=e.gridArray[n][r];if(null==o){var i={row:n,column:r};t.push(i)}}return t},t.prototype.getDropRowAndColumn=function(e){var t=this,n=e.row,r=e.column,o={row:n,column:r};for(n++;n<t.row;){var i=t.gridArray[n][r];if(null!=i)break;o.row++,n++}return o},t}(BaseClass);__reflect(GridManager.prototype,"GridManager");var BattleData=function(){function e(){}return e.reset=function(){this.enterLv=0,this.curStep=0,this.targetStep=0,this.curScore=0,this.targetScore=0,this.isOver=!1,this.isWin=!1},e.initLvData=function(e){this.reset()},e.enterLv=0,e.curStep=0,e.targetStep=0,e.curScore=0,e.targetScore=0,e.isOver=!1,e.isWin=!1,e}();__reflect(BattleData.prototype,"BattleData");var BattleModel=function(e){function t(t){var n=e.call(this,t)||this;n.maxMapCount=15,n.openMapCount=2,n.currMission=1,n.passMission=2;var r=n;return r.init(),n}return __extends(t,e),t.prototype.init=function(){var e=this;e.maxMapCount=parseInt(GlobleVOData.getDataByFilter(GlobleVOData.ServerConfigVO,"id","MAX_MAP_COUNT")[0].value)},t}(BaseModel);__reflect(BattleModel.prototype,"BattleModel");var BattleState;!function(e){e[e.DealLogic=0]="DealLogic",e[e.Play=1]="Play"}(BattleState||(BattleState={}));var BattleMap=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.skinName=SkinName.BattleMapSkin,r}return __extends(t,e),t.prototype.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.open.call(this,t);var r=this;r._battleController=t[0],r._model=r._battleController.getModel(),r.init(),r.initMap(),r.addEvents()},t.prototype.init=function(){},t.prototype.initMap=function(){for(var e=this,t=e._model.openMapCount;t>0;t--){var n=e.getMapVO(t),r=e.createMap(n.icon);e.initLevel(r,t,n),e.mapGroup.addChild(r)}},t.prototype.initLevel=function(e,t,n){for(var r=this,o=0;o<n.path.length;o++){var i=ObjectUtils.splitToNumber(n.path[o]),a=ObjectPool.pop(MapBtnItem,"MapBtnItem");a.anchorOffsetX=a.anchorOffsetY=45,a.onAwake([t-1,o+1,i[0],i[1],r._model]),e.addChild(a)}},t.prototype.addMap=function(){var e=this;if(e._model.openMapCount<e._model.maxMapCount){e._model.openMapCount++;var t=e.getMapVO(e._model.openMapCount),n=e.createMap(t.icon);e.initLevel(n,e._model.openMapCount,t),e.mapGroup.addChildAt(n,0)}},t.prototype.createMap=function(e){var t=ObjectPool.pop(eui.Group,"eui.Group");t.width=720,t.height=1280;var n=ObjectPool.pop(eui.Image,"eui.Image"),r=PathConfig.MapPath.replace("{0}",e+"");return App.DisplayUtils.addAsyncBitmapToImage(r,n),t.addChild(n),t},t.prototype.addEvents=function(){e.prototype.addEvents.call(this)},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this)},t.prototype.onGetMapPos=function(e){Log.trace(e.stageX+","+e.stageY)},t.prototype.getMapVO=function(e){var t=this;return GlobleVOData.getData(GlobleVOData.MapVO,parseInt(t.getMapId(e)))},t.prototype.getMapId=function(e){return e>9?"100"+e:"1000"+e},t}(BaseEuiView);__reflect(BattleMap.prototype,"BattleMap");var BattleMissionView=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.state=BattleState.Play;var o=r;return o.skinName=SkinName.BattleMissionViewSkin,o.setResources(["battleMission"]),r}return __extends(t,e),t.prototype.initUI=function(){e.prototype.initUI.call(this);this.initLinePanel(),this.initCellPanel(),this.initCell()},t.prototype.initData=function(){e.prototype.initData.call(this)},t.prototype.initCell=function(){App.GridManager.clearList=[],App.GridManager.cleanGridArray();for(var e=0;e<App.GridManager.row;e++)for(var t=0;t<App.GridManager.column;t++){var n=App.GridManager.genInitGridId(e,t),r=BattleLogic.createCell(this.gridPanel,e,t,n);r.x=App.GridManager.getGridPosX(t),r.y=App.GridManager.getGridPosY(e)}},t.prototype.initCellPanel=function(){this.gridPanel=new egret.Sprite,this.gridPanel.name="cellPanel",this.gridPanel.width=App.GridManager.column*Grid.Width+(App.GridManager.column-1)*App.GridManager.columnSpace,this.gridPanel.height=App.GridManager.row*Grid.Height+(App.GridManager.row-1)*App.GridManager.rowSpace,this.gridPanel.anchorOffsetX=this.gridPanel.width/2,this.gridPanel.anchorOffsetY=this.gridPanel.height,this.gridPanel.x=App.StageUtils.getWidth()/2,this.gridPanel.y=App.StageUtils.getHeight()-250;var e=new eui.Rect(this.gridPanel.width,this.gridPanel.height,255);e.alpha=0,this.gridPanel.addChild(e),this.gridPanel.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegan,this),this.gridPanel.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gridPanel.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.gridPanel.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onOutSide,this),this.addChild(this.gridPanel)},t.prototype.initLinePanel=function(){this.linePanel=new egret.Sprite,this.linePanel.name="linePanel",this.linePanel.width=App.GridManager.column*Grid.Width+(App.GridManager.column-1)*App.GridManager.columnSpace,this.linePanel.height=App.GridManager.row*Grid.Height+(App.GridManager.row-1)*App.GridManager.rowSpace,this.linePanel.anchorOffsetX=this.linePanel.width/2,this.linePanel.anchorOffsetY=this.linePanel.height,this.linePanel.x=App.StageUtils.getWidth()/2,this.linePanel.y=App.StageUtils.getHeight()-250,this.linePanel.graphics.beginFill(65280,0),this.linePanel.graphics.drawRect(0,0,this.linePanel.width,this.linePanel.height),this.linePanel.graphics.endFill(),this.addChild(this.linePanel)},t.prototype.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.open.call(this,t);var r=this;r.txt_mission.text=t[0]+""},t.prototype.addEvents=function(){e.prototype.addEvents.call(this);var t=this;t.btn_pause.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPauseHandler,t),t.setBtnEffect(["btn_pause"]),t.registerFunc(BattleConst.GRID_RESET_COMPLETE,t.cleanOneByeOne,t),t.registerFunc(BattleConst.GRID_DROP_COMPLETE,t.onGridDropComplete,t)},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this);var t=this;t.btn_pause.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onPauseHandler,t)},t.prototype.onPauseHandler=function(){},t.prototype.onOutSide=function(){this.onTouchEnd()},t.prototype.onTouchBegan=function(e){this.state==BattleState.Play&&BattleLogic.doTouchBegan(this.pointLine,this.linePanel,this.pointLineBeganCell,e.stageX,e.stageY)},t.prototype.onTouchMove=function(e){this.state==BattleState.Play&&BattleLogic.doTouchMove(this.pointLine,this.linePanel,this.pointLineBeganCell,e.stageX,e.stageY)},t.prototype.onTouchEnd=function(){BattleLogic.doTouchMoveEnd(this.state,this.cleanOneByeOne),this.linePanel.removeChildren()},t.prototype.cleanOneByeOne=function(){var e=App.GridManager.clearList.length;if(0==e)BattleLogic.deleteCleanList(),BattleLogic.dropAndFillCell(this.gridPanel);else{var t=App.GridManager.clearList[0];BattleLogic.createDirtyAndScore(this.gridPanel,t),t.reset(),BattleLogic.cleanIndex++}},t.prototype.onGridDropComplete=function(){var e=App.GridManager.isAllMove();0==e&&(egret.log("Drop over"),this.onStepOver())},t.prototype.onStepOver=function(){this.state=BattleState.Play,this.reduceStep()},t.prototype.reduceStep=function(){BattleData.curStep--,this.txt_step.text=BattleData.curStep.toString(),BattleData.curStep<=0?(BattleData.curStep=0,0==BattleData.isOver&&(BattleData.isOver=!0,BattleData.isWin=!1)):BattleData.curScore>=BattleData.targetScore&&0==BattleData.isOver&&(BattleData.isOver=!0,BattleData.isWin=!0)},t}(BaseEuiView);__reflect(BattleMissionView.prototype,"BattleMissionView");var BattleView=function(e){function t(t,n){var r=e.call(this,t,n)||this,o=r;return o.skinName=SkinName.BattleViewSkin,o.setResources(["battle"]),r}return __extends(t,e),t.prototype.initUI=function(){e.prototype.initUI.call(this);var t=this;t.currency.initUI(),t.map=new BattleMap(t.controller,LayerManager.GAME_MAP_LAYER),t.scroller.viewport=t.map.container,t.map.addToParent()},t.prototype.initData=function(){e.prototype.initData.call(this)},t.prototype.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.open.call(this,t);var r=this;r._model=r.controller.getModel(),r.map.open(r.controller),r.scroller.validateNow(),r.scroller.viewport.scrollV=r.scroller.viewport.contentHeight-r.scroller.viewport.height},t.prototype.addEvents=function(){e.prototype.addEvents.call(this);var t=this;t.scroller.addEventListener(egret.Event.CHANGE,t.onMapChange,t)},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this);var t=this;t.scroller.removeEventListener(egret.Event.CHANGE,t.onMapChange,t)},t.prototype.onMapChange=function(){var e=this;0==e.scroller.viewport.scrollV&&(e.map.addMap(),e.scroller.viewport.validateNow())},t}(BaseEuiView);__reflect(BattleView.prototype,"BattleView");var MapBtnItem=function(e){function t(){return e.call(this,SkinName.MapBtnItemSkin)||this}return __extends(t,e),t.prototype.onAwake=function(t){e.prototype.onAwake.call(this,t);var n=this;n.init(),n.initState(),n.initPosition(),n.addEvents()},t.prototype.init=function(){var e=this;e._mapIndex=e.data[0],e._model=e.data[4],e.txt_index.text=2*e._mapIndex*10+e.data[1]+""},t.prototype.initPosition=function(){var e=this;e.x=e.data[2],e.y=e.data[3]},t.prototype.initState=function(){var e=this;e._isListener=!0,parseInt(e.txt_index.text)==e._model.currMission?e.itemImg.source="battle_blue":parseInt(e.txt_index.text)==e._model.passMission+1?e.itemImg.source="battle_red":parseInt(e.txt_index.text)<=e._model.passMission?e.itemImg.source="battle_green":(e._isListener=!1,e.itemImg.source="battle_black")},t.prototype.addEvents=function(){var e=this;e.btn_level.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onSelectLevel,e),e.setBtnEffect(["btn_level"])},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this);var t=this;t.btn_level.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onSelectLevel,t)},t.prototype.onSelectLevel=function(){var e=this;return e._isListener?void App.ControllerManager.applyFunc(ControllerConst.Battle,BattleConst.BATTLE_SELECT_LEVEL,parseInt(e.txt_index.text)):void App.MessageManger.showText(App.LanguageManager.getLanguageText("battle.txt.02"))},t}(BaseEuiItem);__reflect(MapBtnItem.prototype,"MapBtnItem");var MissionPanel=function(e){function t(t,n){var r=e.call(this,t,n,SkinName.MissionPanelSkin)||this;return r}return __extends(t,e),t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;n._mission=e[0],n.txt_title.text=App.LanguageManager.getLanguageText("battle.txt.01",n._mission)},t.prototype.addEvents=function(){e.prototype.addEvents.call(this);var t=this;t.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onEnterBattleMission,t),t.setBtnEffect(["btn_start","btn_close"])},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this);var t=this;t.btn_start.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onEnterBattleMission,t)},t.prototype.onEnterBattleMission=function(){var e=this;e.applyFunc(BattleConst.BATTLE_ENTER_MISSION,e._mission)},t}(BaseEuiAlert);__reflect(MissionPanel.prototype,"MissionPanel");var UI;!function(e){var t=function(){function e(e,t){this._view=null,this._btnArr=[];var n=this;n._view=e,n._btnArr=t,n.initBtnEffect()}return e.prototype.initBtnEffect=function(){var e=this;if(e._btnArr&&e._btnArr.length)for(var t=e._btnArr.length,n=0;t>n;n++)e._view[e._btnArr[n]].addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onBtnBegin,e),e._view[e._btnArr[n]].anchorOffsetY=e._view[e._btnArr[n]].height/2,e._view[e._btnArr[n]].anchorOffsetX=e._view[e._btnArr[n]].width/2,e._view[e._btnArr[n]].x=e._view[e._btnArr[n]].x+e._view[e._btnArr[n]].width/2,e._view[e._btnArr[n]].y=e._view[e._btnArr[n]].y+e._view[e._btnArr[n]].height/2},e.prototype.onBtnBegin=function(e){var t=this,n=e.target;n&&(t._curBtn=n);var r=n.name;if(r)var o=Number(r.split("_")[1]),i=Number("0x"+r.split("_")[3]);var a=r.split("#")[1];if(a)if(o||(o=1),t._curType=o,n.$stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,t.onTouchCancle,t),n.$stage.addEventListener(egret.TouchEvent.TOUCH_END,t.onTouchEnd,t),e.updateAfterEvent(),1==o)n.scaleY=n.scaleY-.1,n.scaleX=n.scaleX-.1;else if(2==o){if(n.numChildren){var s=n.getChildAt(0);s&&(s.visible=!0);var l=n.getChildAt(1);l&&(l.visible=!1);var c=n.getChildAt(2);i&&c&&(c.textColor=i)}}else if(3==o){if(n.scaleY=n.scaleY-.1,n.scaleX=n.scaleX-.1,n.numChildren){var s=n.getChildAt(0);s&&(s.visible=!0);var l=n.getChildAt(1);l&&(l.visible=!1);var c=n.getChildAt(2);i&&c&&(c.textColor=i)}}else if(4==o){var s=n.getChildAt(0);s&&(s.visible=!0);var l=n.getChildAt(1);l&&(l.visible=!1)}},e.prototype.onTouchCancle=function(e){var t=this,n=t._curBtn;if(n){var r=e.$currentTarget,o=Number("0x"+n.name.split("_")[2]);if(r.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,t.onTouchCancle,t),r.removeEventListener(egret.TouchEvent.TOUCH_END,t.onTouchEnd,t),1==t._curType)n.scaleY=n.scaleY+.1,n.scaleX=n.scaleX+.1;else if(2==t._curType){if(n.numChildren){var i=n.getChildAt(0);i&&(i.visible=!1);var a=n.getChildAt(1);a&&(a.visible=!0);var s=n.getChildAt(2);o&&s&&(s.textColor=o)}}else if(3==t._curType){if(n.scaleY=n.scaleY+.1,n.scaleX=n.scaleX+.1,n.numChildren){var i=n.getChildAt(0);i&&(i.visible=!1);var a=n.getChildAt(1);a&&(a.visible=!0);var s=n.getChildAt(2);
o&&s&&(s.textColor=o)}}else if(4==t._curType){var i=n.getChildAt(0);i&&(i.visible=!1);var a=n.getChildAt(1);a&&(a.visible=!0)}}},e.prototype.onTouchEnd=function(e){var t=this,n=t._curBtn;if(n){var r=e.$currentTarget,o=Number("0x"+n.name.split("_")[2]);if(r.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,t.onTouchCancle,t),r.removeEventListener(egret.TouchEvent.TOUCH_END,t.onTouchEnd,t),1==t._curType)n.scaleY=n.scaleY+.1,n.scaleX=n.scaleX+.1;else if(2==t._curType){if(n.numChildren){var i=n.getChildAt(0);i&&(i.visible=!1);var a=n.getChildAt(1);a&&(a.visible=!0);var s=n.getChildAt(2);o&&s&&(s.textColor=o)}}else if(3==t._curType){if(n.scaleY=n.scaleY+.1,n.scaleX=n.scaleX+.1,n.numChildren){var i=n.getChildAt(0);i&&(i.visible=!1);var a=n.getChildAt(1);a&&(a.visible=!0);var s=n.getChildAt(2);o&&s&&(s.textColor=o)}}else if(4==t._curType){var i=n.getChildAt(0);i&&(i.visible=!1);var a=n.getChildAt(1);a&&(a.visible=!0)}}},e.prototype.dispose=function(){var e=this;if(e._btnArr&&e._btnArr.length)for(var t=e._btnArr.length,n=0;t>n;n++)e._view[e._btnArr[n]].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onBtnBegin,e),e._view[e._btnArr[n]].anchorOffsetY=e._view[e._btnArr[n]].height/2,e._view[e._btnArr[n]].anchorOffsetX=e._view[e._btnArr[n]].width/2,e._view[e._btnArr[n]].x=e._view[e._btnArr[n]].x+e._view[e._btnArr[n]].width/2,e._view[e._btnArr[n]].y=e._view[e._btnArr[n]].y+e._view[e._btnArr[n]].height/2;e._btnArr=[],e._curBtn=null},e}();e.BtnEffectComponent=t,__reflect(t.prototype,"UI.BtnEffectComponent")}(UI||(UI={}));var ButtonCom=function(e){function t(){return e.call(this,SkinName.ButtonComSkin)||this}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this)},t.prototype.onAwake=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.onAwake.call(this,t)},t}(BaseEuiItem);__reflect(ButtonCom.prototype,"ButtonCom");var CurrencyCom=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.skinName=SkinName.CurrencyComSkin,r}return __extends(t,e),t.prototype.initUI=function(){e.prototype.initUI.call(this);var t=this;t.addEvents()},t.prototype.addEvents=function(){e.prototype.addEvents.call(this)},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this)},t}(BaseEuiView);__reflect(CurrencyCom.prototype,"CurrencyCom");var HallController=function(e){function t(){var t=e.call(this)||this,n=t;return n._hall=new HallView(n,LayerManager.GAME_UI_LAYER),App.ViewManager.register(ViewConst.Hall,n._hall),n._hallModel=new HallModel(n),n._hallProxy=new HallProxy(n),n.registerFunc(HallConst.HALL_INIT,n.onHallInit,n),t}return __extends(t,e),t.prototype.onHallInit=function(e){var t=this;App.ViewManager.open(ViewConst.Hall,t._hallModel)},t}(BaseController);__reflect(HallController.prototype,"HallController");var HallProxy=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(BaseProxy);__reflect(HallProxy.prototype,"HallProxy");var HallConst=function(){function e(){}return e.HALL_INIT=1e4,e}();__reflect(HallConst.prototype,"HallConst");var HallModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(BaseModel);__reflect(HallModel.prototype,"HallModel");var HallView=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.skinName=SkinName.HallViewSkin,r.setResources(["hall"]),r}return __extends(t,e),t.prototype.initUI=function(){e.prototype.initUI.call(this);var t=this;t.currency.initUI()},t.prototype.initData=function(){e.prototype.initData.call(this)},t.prototype.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.open.call(this,t);t[0]},t.prototype.addEvents=function(){e.prototype.addEvents.call(this);var t=this;t.btn_checkpoint.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onGotoCheckpoint,t),t.setBtnEffect(["btn_checkpoint"])},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this);var t=this;t.btn_checkpoint.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onGotoCheckpoint,t)},t.prototype.onGotoCheckpoint=function(){},t}(BaseEuiView);__reflect(HallView.prototype,"HallView");var GameLoading=function(e){function t(){var t=e.call(this)||this;return t.content=null,t.speed=.6,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.averageUtils=new AverageUtils,this.content=new egret.Sprite,this.content.graphics.beginFill(0,.2),this.content.graphics.drawRect(0,0,App.StageUtils.getWidth(),App.StageUtils.getHeight()),this.content.graphics.endFill(),this.content.touchEnabled=!0,this.uiImageContainer=new egret.DisplayObjectContainer,this.uiImageContainer.x=.5*this.content.width,this.uiImageContainer.y=.5*this.content.height,this.content.addChild(this.uiImageContainer),RES.getResByUrl("resource/common/atlas/load_Reel.png",function(e){var t=new egret.Bitmap;t.texture=e,t.x=.5*-t.width,t.y=.5*-t.height,this.uiImageContainer.addChild(t)},this,RES.ResourceItem.TYPE_IMAGE)},t.prototype.showLoading=function(){App.StageUtils.getStage().addChild(this.content),App.TimerManager.doFrame(1,0,this.enterFrame,this)},t.prototype.hideLoading=function(){this.content&&this.content.parent&&(App.StageUtils.getStage().removeChild(this.content),this.uiImageContainer.rotation=0),App.TimerManager.remove(this.enterFrame,this)},t.prototype.enterFrame=function(e){this.averageUtils.push(this.speed*e),this.uiImageContainer.rotation+=this.averageUtils.getValue()},t}(BaseClass);__reflect(GameLoading.prototype,"GameLoading");var LoadingController=function(e){function t(){var t=e.call(this)||this;return t.loadingView=new LoadingView(t,LayerManager.GAME_UI_LAYER),App.ViewManager.register(ViewConst.Loading,t.loadingView),t.registerFunc(LoadingConst.SetProgress,t.setProgress,t),t}return __extends(t,e),t.prototype.setProgress=function(e,t){this.loadingView.setProgress(e,t)},t}(BaseController);__reflect(LoadingController.prototype,"LoadingController");var LoadingView=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.skinName=SkinName.LoadingUISkin,r}return __extends(t,e),t.prototype.setProgress=function(e,t){this.txtMsg.text="资源加载中..."+e+"/"+t},t}(BaseEuiView);__reflect(LoadingView.prototype,"LoadingView");var LoginController=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=this;e._loginModel=new LoginModel(e),e._loginView=new LoginView(e,LayerManager.GAME_UI_LAYER),App.ViewManager.register(ViewConst.Login,e._loginView),this._loginProxy=new LoginProxy(this),e.registerMessage()},t.prototype.registerMessage=function(){this.registerFunc(LoginConst.LOGIN_SEND_SERVER,this.onLogin,this),this.registerFunc(LoginConst.LOGIN_SUCCESS,this.loginSuccess,this)},t.prototype.onLogin=function(e){this._loginProxy.login(e)},t.prototype.loginSuccess=function(e){var t=this;t._loginModel.userInfo=e,t._loginView.loginSuccess(),App.ViewManager.close(ViewConst.Login);t.getControllerModel(ControllerConst.Login)},t}(BaseController);__reflect(LoginController.prototype,"LoginController");var LoginProxy=function(e){function t(t){var n=e.call(this,t)||this;return n.receiveServerMsg(HttpConst.USER_LOGIN,n.loginSuccess,n),n}return __extends(t,e),t.prototype.login=function(e){var t={uName:e};this.sendHttpMsg(HttpConst.USER_LOGIN,t)},t.prototype.loginSuccess=function(e){this.applyFunc(LoginConst.LOGIN_SUCCESS,e)},t}(BaseProxy);__reflect(LoginProxy.prototype,"LoginProxy");var LoginConst=function(){function e(){}return e.LOGIN_SEND_SERVER=10001,e.LOGIN_SUCCESS=10002,e}();__reflect(LoginConst.prototype,"LoginConst");var LoginModel=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(BaseModel);__reflect(LoginModel.prototype,"LoginModel");var LoginView=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.skinName=SkinName.LoginViewSkin,r.setResources(["login"]),r}return __extends(t,e),t.prototype.initUI=function(){e.prototype.initUI.call(this)},t.prototype.initData=function(){e.prototype.initData.call(this);var t=this,n="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",r=["precision lowp float;\nvarying vec2 vTextureCoord;","varying vec4 vColor;\n","uniform sampler2D uSampler;","uniform vec2 center;","uniform vec3 params;","uniform float time;","void main()","{","vec2 uv = vTextureCoord.xy;","vec2 texCoord = uv;","float dist = distance(uv, center);","if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )","{","float diff = (dist - time);","float powDiff = 1.0 - pow(abs(diff*params.x), params.y);","float diffTime = diff  * powDiff;","vec2 diffUV = normalize(uv - center);","texCoord = uv + (diffUV * diffTime);","}","gl_FragColor = texture2D(uSampler, texCoord);","}"].join("\n"),o=new egret.CustomFilter(n,r,{center:{x:.5,y:.5},params:{x:10,y:.8,z:.1},time:0});App.TimerManager.doFrame(0,0,function(){o.uniforms.time+=.01,o.uniforms.time>1&&(o.uniforms.time=0)},t),t.bgImg.filters=[o]},t.prototype.open=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.open.call(this,t)},t.prototype.addEvents=function(){e.prototype.addEvents.call(this);var t=this;t.btn_random.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onRandomName,t),t.btn_enter.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onLogin,t),t.setBtnEffect(["btn_random","btn_enter"])},t.prototype.removeEvents=function(){e.prototype.removeEvents.call(this);var t=this;t.btn_random.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onRandomName,t),t.btn_enter.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.onLogin,t)},t.prototype.close=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.close.call(this,t)},t.prototype.onLogin=function(){var e=this;""!=e.txt_input.text&&(App.SceneManager.clear(),App.SceneManager.runScene(SceneConsts.BATTLE))},t.prototype.onRandomName=function(){},t.prototype.loginSuccess=function(){},t}(BaseEuiView);__reflect(LoginView.prototype,"LoginView");